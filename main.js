(()=>{"use strict";var e=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n},n=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";n.preventDefault();var o=n.submitter,a=o.textContent;t(!0,o,a,r),e().then((function(){n.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){t(!1,o,a)}))},r={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"25acbbe0-12c1-426d-be21-ec07addb3936","Content-Type":"application/json"}},o=function(t,n){return fetch("".concat(r.baseUrl,"/").concat(t),n).then(e)},a=function(e){return o("users/me/avatar",{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})})};function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i,u=function(e,t,n,r,o){var a=document.querySelector("#card-template").content.cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__like-count"),l=a.querySelector(".card__like-button"),s=a.querySelector(".card__delete-button");if(a.querySelector(".card__title").textContent=e.name,i.src=e.link,i.alt=e.name,e.likes.length){u.textContent=e.likes.length,u.classList.add("card__like-count_is-active");var d,f=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw a}}}}(e.likes);try{for(f.s();!(d=f.n()).done;)d.value._id===t&&l.classList.add("card__like-button_is-active")}catch(e){f.e(e)}finally{f.f()}}return e.owner._id!==t&&s.classList.add("card__delete-button_hidden"),i.addEventListener("click",(function(){o(e)})),s.addEventListener("click",(function(t){n(t,e)})),a.querySelector(".card__like-button").addEventListener("click",(function(t){r(t,e)})),a},l=function(e,t){var n;(n=t._id,o("cards/".concat(n),{method:"DELETE",headers:r.headers})).then((function(){e.target.closest(".card").remove()})).catch((function(e){console.log(e)}))},s=function(e,t){var n,a=e.target,c=e.target.closest(".card__like-block").querySelector(".card__like-count");a.classList.contains("card__like-button_is-active")?function(e){return o("cards/likes/".concat(e),{method:"DELETE",headers:r.headers})}(t._id).then((function(e){a.classList.remove("card__like-button_is-active"),e.likes.length?c.textContent=e.likes.length:c.classList.remove("card__like-count_is-active")})).catch((function(e){console.log(e)})):(n=t._id,o("cards/likes/".concat(n),{method:"PUT",headers:r.headers})).then((function(e){a.classList.add("card__like-button_is-active"),c.classList.add("card__like-count_is-active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)}))},d=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",p)},f=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p)},p=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");f(t)}},m=function(e,t,n){var r=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},v=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},y=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);v(n,r,t),n.forEach((function(n){m(e,n,t)}))};function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h,b=document.querySelector(".places__list"),S=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),E=document.querySelectorAll(".popup"),L=document.querySelectorAll(".popup__close"),C=document.querySelector(".popup_type_edit"),q=document.querySelector(".profile__edit-button"),A=document.forms["edit-profile"],x=A.elements.name,w=A.elements.description,j=document.querySelector(".popup_type_change-avatar"),T=document.forms["new-avatar"],O=T.elements.link,P=document.querySelector(".popup_type_new-card"),B=document.querySelector(".profile__add-button"),I=document.forms["new-place"],D=I.elements["place-name"],M=I.elements.link,U=document.querySelector(".popup_type_image"),N=document.querySelector(".popup__image"),H=document.querySelector(".popup__caption"),J={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},V=function(e){d(U),N.src=e.link,N.alt=e.name,H.textContent=e.name};Promise.all([o("users/me",{headers:r.headers}),o("cards",{headers:r.headers})]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];i=o._id,S.textContent=o.name,g.textContent=o.about,k.setAttribute("style","background-image: url(".concat(o.avatar,");")),a.forEach((function(e){var t;t=u(e,i,l,s,V),b.append(t)}))})).catch((function(e){console.log(e)})),L.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.closest(".popup");f(t)}))})),E.forEach((function(e){e.addEventListener("click",(function(t){!function(e,t){e.currentTarget===e.target&&f(t)}(t,e)}))})),q.addEventListener("click",(function(){x.value=S.textContent,w.value=g.textContent,y(A,J),d(C)})),A.addEventListener("submit",(function(e){n((function(){return function(e,t){return o("users/me",{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})})}(x.value,w.value).then((function(e){S.textContent=e.name,g.textContent=e.about,f(C)}))}),e)})),B.addEventListener("click",(function(){d(P)})),I.addEventListener("submit",(function(e){n((function(){return(e=D.value,t=M.value,o("cards",{method:"POST",headers:r.headers,body:JSON.stringify({name:e,link:t})})).then((function(e){var t=u(e,i,l,s,V);b.prepend(t),f(P),y(I,J)}));var e,t}),e)})),k.addEventListener("click",(function(){d(j)})),T.addEventListener("submit",(function(e){n((function(){return Promise.all([(e=O.value,fetch("".concat(e),{method:"HEAD"}).then((function(e){if(!e.ok&&!e.headers.get("Content-Type").includes("image"))return Promise.reject("Ошибка: ".concat(e.status))}))),a(O.value)]).then((function(e){var t=e[1];k.setAttribute("style","background-image: url(".concat(t.avatar,");")),f(j),y(T,J)}));var e}),e)})),h=J,Array.from(document.querySelectorAll(h.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);v(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?m(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),v(n,r,t)}))}))}(e,h)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxFQUFjQSxFQUFhd0Usa0JBQW1CdkUsRUFJOUUsQ0EwQk13RSxDQUFRMUUsRUFBYUMsRUFBY0MsR0FDbkNJLEVBQWtCQyxFQUFXQyxFQUFlTixFQUM5QyxHQUNGLEdBQ0YsQ0FTSXlFLENBQWtCM0UsRUFBYUUsRUFDakMsRyIsInNvdXJjZXMiOlsid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvdXRpbHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL2FwaS5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3NjcmlwdHMvY2FyZC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3NjcmlwdHMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBjaGVja1Jlc3BvbnNlID0gKHJlcykgPT4ge1xyXG4gIGlmIChyZXMub2spIHtcclxuICAgIHJldHVybiByZXMuanNvbigpXHJcbiAgfVxyXG4gIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbn1cclxuXHJcbmNvbnN0IHJlbmRlckxvYWRpbmcgPSAoaXNMb2FkaW5nLCBidXR0b24sIGJ1dHRvblRleHQgPSAn0KHQvtGF0YDQsNC90LjRgtGMJywgbG9hZGluZ1RleHQgPSAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nKSA9PiB7XHJcbiAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHRcclxuICB9IGVsc2Uge1xyXG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gYnV0dG9uVGV4dFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZVN1Ym1pdCA9IChyZXF1ZXN0LCBldnQsIGxvYWRpbmdUZXh0ID0gXCLQodC+0YXRgNCw0L3QtdC90LjQtS4uLlwiKSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBjb25zdCBpbml0aWFsVGV4dCA9IHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcclxuXHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIGluaXRpYWxUZXh0LCBsb2FkaW5nVGV4dCk7XHJcbiAgcmVxdWVzdCgpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGDQntGI0LjQsdC60LA6ICR7ZXJyfWApO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uLCBpbml0aWFsVGV4dCk7XHJcbiAgICB9KTtcclxufVxyXG4iLCJpbXBvcnQgeyBjaGVja1Jlc3BvbnNlIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMuanMnO1xyXG5cclxuY29uc3QgY29uZmlnID0ge1xyXG4gIGJhc2VVcmw6ICdodHRwczovL21lc3RvLm5vbW9yZXBhcnRpZXMuY28vdjEvd2ZmLWNvaG9ydC0yJyxcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiAnMjVhY2JiZTAtMTJjMS00MjZkLWJlMjEtZWMwN2FkZGIzOTM2JyxcclxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHJlcXVlc3QgPSAoZW5kcG9pbnQsIG9wdGlvbnMpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9LyR7ZW5kcG9pbnR9YCwgb3B0aW9ucykudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGdldFVzZXJEYXRhID0gKCkgPT4ge1xyXG4gIHJldHVybiByZXF1ZXN0KCd1c2Vycy9tZScsIHtcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjaGFuZ2VVc2VyRGF0YSA9ICh1c2VyTmFtZSwgdXNlckRlc2NyaXB0aW9uKSA9PiB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoJ3VzZXJzL21lJywge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIG5hbWU6IHVzZXJOYW1lLFxyXG4gICAgICBhYm91dDogdXNlckRlc2NyaXB0aW9uXHJcbiAgICB9KVxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY2hhbmdlVXNlckF2YXRhciA9IChsaW5rSW1hZ2UpID0+IHtcclxuICByZXR1cm4gcmVxdWVzdCgndXNlcnMvbWUvYXZhdGFyJywge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogbGlua0ltYWdlXHJcbiAgICB9KVxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY2hlY2tJbWFnZVVybCA9IChsaW5rSW1hZ2UpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7bGlua0ltYWdlfWAsIHtcclxuICAgIG1ldGhvZDogJ0hFQUQnLFxyXG4gIH0pXHJcbiAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAoIXJlcy5vayAmJiAhcmVzLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnKS5pbmNsdWRlcygnaW1hZ2UnKSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xyXG4gIHJldHVybiByZXF1ZXN0KCdjYXJkcycsIHtcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzZW5kTmV3Q2FyZCA9IChjYXJkTmFtZSwgY2FyZExpbmspID0+IHtcclxuICByZXR1cm4gcmVxdWVzdCgnY2FyZHMnLCB7XHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBuYW1lOiBjYXJkTmFtZSxcclxuICAgICAgbGluazogY2FyZExpbmtcclxuICAgIH0pXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBkZWxldGVDdXJyZW50Q2FyZCA9IChjYXJkSWQpID0+IHtcclxuICByZXR1cm4gcmVxdWVzdChgY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBwdXRMaWtlID0gKGNhcmRJZCkgPT4ge1xyXG4gIHJldHVybiByZXF1ZXN0KGBjYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGRlbGV0ZUxpa2UgPSAoY2FyZElkKSA9PiB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoYGNhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVyc1xyXG4gIH0pO1xyXG59XHJcbiIsImltcG9ydCB7IGRlbGV0ZUN1cnJlbnRDYXJkLCBwdXRMaWtlLCBkZWxldGVMaWtlIH0gZnJvbSBcIi4vYXBpXCI7XHJcblxyXG5leHBvcnQgY29uc3QgY3JlYXRlQ2FyZCA9IChjYXJkRGF0YSwgdXNlckRhdGFJZCwg0YFhbGxiYWNrRm9yUmVtb3ZlLCDRgWFsbGJhY2tGb3JMaWtlLCDRgWFsbGJhY2tGb3JTaG93SW1hZ2UpID0+IHtcclxuICBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2FyZC10ZW1wbGF0ZScpLmNvbnRlbnQ7XHJcbiAgY29uc3QgbmV3Q2FyZCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgY29uc3QgbmV3Q2FyZEltYWdlID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9faW1hZ2UnKTtcclxuICBjb25zdCBuZXdDYXJkTGlrZUNvdW50ID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpO1xyXG4gIGNvbnN0IG5ld0NhcmRMaWtlQnV0dG9uID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKTtcclxuICBjb25zdCBuZXdDYXJkRGVsZXRlQnV0dG9uID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpO1xyXG5cclxuICBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcclxuICBuZXdDYXJkSW1hZ2Uuc3JjID0gY2FyZERhdGEubGluaztcclxuICBuZXdDYXJkSW1hZ2UuYWx0ID0gY2FyZERhdGEubmFtZTtcclxuXHJcbiAgaWYgKGNhcmREYXRhLmxpa2VzLmxlbmd0aCkge1xyXG4gICAgbmV3Q2FyZExpa2VDb3VudC50ZXh0Q29udGVudCA9IGNhcmREYXRhLmxpa2VzLmxlbmd0aDtcclxuICAgIG5ld0NhcmRMaWtlQ291bnQuY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1jb3VudF9pcy1hY3RpdmUnKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IG93bmVyTGlrZSBvZiBjYXJkRGF0YS5saWtlcykge1xyXG4gICAgICBpZiAob3duZXJMaWtlWydfaWQnXSA9PT0gdXNlckRhdGFJZCkge1xyXG4gICAgICAgIG5ld0NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpZiAoY2FyZERhdGEub3duZXJbJ19pZCddICE9PSB1c2VyRGF0YUlkKSB7XHJcbiAgICBuZXdDYXJkRGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2RlbGV0ZS1idXR0b25faGlkZGVuJyk7XHJcbiAgfVxyXG5cclxuICBuZXdDYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICDRgWFsbGJhY2tGb3JTaG93SW1hZ2UoY2FyZERhdGEpO1xyXG4gIH0pO1xyXG4gIG5ld0NhcmREZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XHJcbiAgICDRgWFsbGJhY2tGb3JSZW1vdmUoZXZ0LCBjYXJkRGF0YSk7XHJcbiAgfSk7XHJcbiAgbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICAgINGBYWxsYmFja0Zvckxpa2UoZXZ0LCBjYXJkRGF0YSk7XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBuZXdDYXJkO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcmVtb3ZlQ2FyZCA9IChldnQsIGNhcmREYXRhKSA9PiB7XHJcbiAgZGVsZXRlQ3VycmVudENhcmQoY2FyZERhdGFbJ19pZCddKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBldnQudGFyZ2V0LmNsb3Nlc3QoJy5jYXJkJykucmVtb3ZlKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgbGlrZUNhcmQgPSAoZXZ0LCBjYXJkRGF0YSkgPT4ge1xyXG4gIGNvbnN0IGxpa2VCdXR0b24gPSBldnQudGFyZ2V0O1xyXG4gIGNvbnN0IGxpa2VDb3VudCA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLmNhcmRfX2xpa2UtYmxvY2snKS5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpO1xyXG5cclxuICBpZiAoIWxpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKSkge1xyXG4gICAgcHV0TGlrZShjYXJkRGF0YVsnX2lkJ10pXHJcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIGxpa2VDb3VudC5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWNvdW50X2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIGxpa2VDb3VudC50ZXh0Q29udGVudCA9IHJlc3VsdC5saWtlcy5sZW5ndGg7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGRlbGV0ZUxpa2UoY2FyZERhdGFbJ19pZCddKVxyXG4gICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcclxuICAgICAgICBpZiAocmVzdWx0Lmxpa2VzLmxlbmd0aCkge1xyXG4gICAgICAgICAgbGlrZUNvdW50LnRleHRDb250ZW50ID0gcmVzdWx0Lmxpa2VzLmxlbmd0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbGlrZUNvdW50LmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2UtY291bnRfaXMtYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufSIsImltcG9ydCAnLi4vcGFnZXMvaW5kZXguY3NzJztcclxuXHJcbmltcG9ydCB7IGNyZWF0ZUNhcmQsIHJlbW92ZUNhcmQsIGxpa2VDYXJkIH0gZnJvbSAnLi9jYXJkLmpzJztcclxuaW1wb3J0IHsgb3Blbk1vZGFsLCBjbG9zZU1vZGFsLCBjbG9zZU1vZGFsT25CYWNrZHJvcENsaWNrIH0gZnJvbSAnLi9tb2RhbC5qcyc7XHJcbmltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIGNsZWFyVmFsaWRhdGlvbiB9IGZyb20gJy4vdmFsaWRhdGlvbi5qcyc7XHJcbmltcG9ydCB7IGdldFVzZXJEYXRhLCBjaGFuZ2VVc2VyRGF0YSwgZ2V0SW5pdGlhbENhcmRzLCBzZW5kTmV3Q2FyZCwgZGVsZXRlQ3VycmVudENhcmQsIGNoYW5nZVVzZXJBdmF0YXIsIGNoZWNrSW1hZ2VVcmwgfSBmcm9tICcuL2FwaS5qcyc7XHJcbmltcG9ydCB7IGhhbmRsZVN1Ym1pdCB9IGZyb20gJy4uL3V0aWxzL3V0aWxzLmpzJztcclxuXHJcbmxldCB1c2VySWQ7XHJcblxyXG5jb25zdCBjYXJkQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYWNlc19fbGlzdCcpO1xyXG5cclxuY29uc3QgdXNlck5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fdGl0bGUnKTtcclxuY29uc3QgdXNlckRlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2Rlc2NyaXB0aW9uJyk7XHJcbmNvbnN0IHVzZXJBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuXHJcbmNvbnN0IHBvcHVwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cCcpO1xyXG5jb25zdCBidXR0b25zQ2xvc2VQb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXBfX2Nsb3NlJyk7XHJcblxyXG5jb25zdCBwcm9maWxlRWRpdFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfZWRpdCcpO1xyXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5jb25zdCBwcm9maWxlRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1snZWRpdC1wcm9maWxlJ107XHJcbmNvbnN0IG5hbWVJbnB1dCA9IHByb2ZpbGVFZGl0Rm9ybS5lbGVtZW50cy5uYW1lO1xyXG5jb25zdCBkZXNjcmlwdGlvbklucHV0ID0gcHJvZmlsZUVkaXRGb3JtLmVsZW1lbnRzLmRlc2NyaXB0aW9uO1xyXG5cclxuY29uc3QgY2hhbmdlQXZhdGFyUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9jaGFuZ2UtYXZhdGFyJyk7XHJcbmNvbnN0IGNoYW5nZUF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1snbmV3LWF2YXRhciddO1xyXG5jb25zdCBjaGFuZ2VBdmF0YXJJbnB1dCA9IGNoYW5nZUF2YXRhckZvcm0uZWxlbWVudHMubGluaztcclxuXHJcbmNvbnN0IGFkZE5ld0NhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX25ldy1jYXJkJyk7XHJcbmNvbnN0IGFkZE5ld0NhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWRkLWJ1dHRvbicpO1xyXG5jb25zdCBhZGROZXdDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zWyduZXctcGxhY2UnXTtcclxuY29uc3QgY2FyZE5hbWVJbnB1dCA9IGFkZE5ld0NhcmRGb3JtLmVsZW1lbnRzWydwbGFjZS1uYW1lJ107XHJcbmNvbnN0IGNhcmRsaW5rSW5wdXQgPSBhZGROZXdDYXJkRm9ybS5lbGVtZW50cy5saW5rO1xyXG5cclxuY29uc3Qgc2hvd0ltYWdlUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9pbWFnZScpO1xyXG5jb25zdCBwb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpXHJcbmNvbnN0IHBvcHVwSW1hZ2VDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19jYXB0aW9uJyk7XHJcblxyXG5jb25zdCB2YWxpZGF0aW9uQ29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogJy5wb3B1cF9fZm9ybScsXHJcbiAgaW5wdXRTZWxlY3RvcjogJy5wb3B1cF9faW5wdXQnLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnBvcHVwX19idXR0b24nLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdwb3B1cF9fYnV0dG9uX2Rpc2FibGVkJyxcclxuICBpbnB1dEVycm9yQ2xhc3M6ICdwb3B1cF9faW5wdXRfdHlwZV9lcnJvcicsXHJcbiAgZXJyb3JDbGFzczogJ3BvcHVwX19lcnJvcl92aXNpYmxlJ1xyXG59XHJcblxyXG5jb25zdCByZW5kZXJDYXJkID0gKGNhcmREYXRhLCB1c2VyRGF0YUlkLCDRgWFsbGJhY2tGb3JSZW1vdmUsINGBYWxsYmFja0Zvckxpa2UsINGBYWxsYmFja0ZvclNob3dJbWFnZSkgPT4ge1xyXG4gIGNvbnN0IG5ld0NhcmQgPSBjcmVhdGVDYXJkKGNhcmREYXRhLCB1c2VyRGF0YUlkLCDRgWFsbGJhY2tGb3JSZW1vdmUsINGBYWxsYmFja0Zvckxpa2UsINGBYWxsYmFja0ZvclNob3dJbWFnZSk7XHJcbiAgY2FyZENvbnRhaW5lci5hcHBlbmQobmV3Q2FyZCk7XHJcbn1cclxuXHJcbmNvbnN0IGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xyXG4gIGNvbnN0IG1ha2VSZXF1ZXN0ID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIGNoYW5nZVVzZXJEYXRhKG5hbWVJbnB1dC52YWx1ZSwgZGVzY3JpcHRpb25JbnB1dC52YWx1ZSlcclxuICAgICAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XHJcbiAgICAgICAgdXNlck5hbWUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xyXG4gICAgICAgIHVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xyXG4gICAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRQb3B1cCk7XHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dCk7XHJcbn1cclxuXHJcbmNvbnN0IGhhbmRsZUNoYW5nZUF2YXRhckZvcm1TdWJtaXQgPSAoZXZ0KSA9PiB7XHJcbiAgY29uc3QgbWFrZVJlcXVlc3QgPSAoKSA9PiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW2NoZWNrSW1hZ2VVcmwoY2hhbmdlQXZhdGFySW5wdXQudmFsdWUpLCBjaGFuZ2VVc2VyQXZhdGFyKGNoYW5nZUF2YXRhcklucHV0LnZhbHVlKV0pXHJcbiAgICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdXNlckRhdGEgPSByZXN1bHRzWzFdO1xyXG4gICAgICAgIHVzZXJBdmF0YXIuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt1c2VyRGF0YS5hdmF0YXJ9KTtgKTtcclxuICAgICAgICBjbG9zZU1vZGFsKGNoYW5nZUF2YXRhclBvcHVwKTtcclxuICAgICAgICBjbGVhclZhbGlkYXRpb24oY2hhbmdlQXZhdGFyRm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dCk7XHJcbn1cclxuXHJcbmNvbnN0IGhhbmRsZUFkZE5ld0NhcmRGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xyXG4gIGNvbnN0IG1ha2VSZXF1ZXN0ID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIHNlbmROZXdDYXJkKGNhcmROYW1lSW5wdXQudmFsdWUsIGNhcmRsaW5rSW5wdXQudmFsdWUpXHJcbiAgICAgIC50aGVuKChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0NhcmQgPSBjcmVhdGVDYXJkKGNhcmREYXRhLCB1c2VySWQsIHJlbW92ZUNhcmQsIGxpa2VDYXJkLCBzaG93SW1hZ2UpO1xyXG4gICAgICAgIGNhcmRDb250YWluZXIucHJlcGVuZChuZXdDYXJkKTtcclxuICAgICAgICBjbG9zZU1vZGFsKGFkZE5ld0NhcmRQb3B1cCk7XHJcbiAgICAgICAgY2xlYXJWYWxpZGF0aW9uKGFkZE5ld0NhcmRGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICAgICAgfSlcclxuICB9XHJcblxyXG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0KTtcclxufVxyXG5cclxuY29uc3Qgc2hvd0ltYWdlID0gKGNhcmREYXRhKSA9PiB7XHJcbiAgb3Blbk1vZGFsKHNob3dJbWFnZVBvcHVwKTtcclxuICBwb3B1cEltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XHJcbiAgcG9wdXBJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xyXG4gIHBvcHVwSW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcclxufVxyXG5cclxuUHJvbWlzZS5hbGwoW2dldFVzZXJEYXRhKCksIGdldEluaXRpYWxDYXJkcygpXSlcclxuICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgY29uc3QgW3VzZXJEYXRhLCBpbml0aWFsQ2FyZHNdID0gcmVzdWx0cztcclxuICAgIHVzZXJJZCA9IHVzZXJEYXRhWydfaWQnXTtcclxuICAgIHVzZXJOYW1lLnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZTtcclxuICAgIHVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xyXG4gICAgdXNlckF2YXRhci5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYGJhY2tncm91bmQtaW1hZ2U6IHVybCgke3VzZXJEYXRhLmF2YXRhcn0pO2ApO1xyXG5cclxuICAgIGluaXRpYWxDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgIHJlbmRlckNhcmQoY2FyZCwgdXNlcklkLCByZW1vdmVDYXJkLCBsaWtlQ2FyZCwgc2hvd0ltYWdlKTtcclxuICAgIH0pO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSk7XHJcblxyXG5idXR0b25zQ2xvc2VQb3B1cHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XHJcbiAgICBjb25zdCBvcGVuZWRQb3B1cCA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLnBvcHVwJyk7XHJcbiAgICBjbG9zZU1vZGFsKG9wZW5lZFBvcHVwKTtcclxuICB9KTtcclxufSk7XHJcblxyXG5wb3B1cHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XHJcbiAgICBjbG9zZU1vZGFsT25CYWNrZHJvcENsaWNrKGV2dCwgaXRlbSk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgbmFtZUlucHV0LnZhbHVlID0gdXNlck5hbWUudGV4dENvbnRlbnQ7XHJcbiAgZGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcclxuICBjbGVhclZhbGlkYXRpb24ocHJvZmlsZUVkaXRGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICBvcGVuTW9kYWwocHJvZmlsZUVkaXRQb3B1cCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUVkaXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcclxuXHJcbmFkZE5ld0NhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgb3Blbk1vZGFsKGFkZE5ld0NhcmRQb3B1cCk7XHJcbn0pO1xyXG5cclxuYWRkTmV3Q2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgaGFuZGxlQWRkTmV3Q2FyZEZvcm1TdWJtaXQpO1xyXG5cclxudXNlckF2YXRhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBvcGVuTW9kYWwoY2hhbmdlQXZhdGFyUG9wdXApO1xyXG59KVxyXG5cclxuY2hhbmdlQXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBoYW5kbGVDaGFuZ2VBdmF0YXJGb3JtU3VibWl0KTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkNvbmZpZyk7IiwiY29uc3Qgb3Blbk1vZGFsID0gKHBvcHVwKSA9PiB7XHJcbiAgcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGNsb3NlTW9kYWxPbkVzY1ByZXNzKTtcclxufVxyXG5cclxuY29uc3QgY2xvc2VNb2RhbCA9IChwb3B1cCkgPT4ge1xyXG4gIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBjbG9zZU1vZGFsT25Fc2NQcmVzcyk7XHJcbn1cclxuXHJcbmNvbnN0IGNsb3NlTW9kYWxPbkVzY1ByZXNzID0gKGV2dCkgPT4ge1xyXG4gIGlmIChldnQua2V5ID09PSAnRXNjYXBlJykge1xyXG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgICBjbG9zZU1vZGFsKG9wZW5lZFBvcHVwKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGNsb3NlTW9kYWxPbkJhY2tkcm9wQ2xpY2sgPSAoZXZ0LCBwb3B1cCkgPT4ge1xyXG4gIGlmIChldnQuY3VycmVudFRhcmdldCA9PT0gZXZ0LnRhcmdldCkgY2xvc2VNb2RhbChwb3B1cCk7XHJcbn1cclxuXHJcbmV4cG9ydCB7IG9wZW5Nb2RhbCwgY2xvc2VNb2RhbCwgY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayB9IiwiY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBmb3JtRGF0YSkgPT4ge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5uYW1lfS1lcnJvcmApO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGZvcm1EYXRhLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGZvcm1EYXRhLmVycm9yQ2xhc3MpO1xyXG59O1xyXG5cclxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZm9ybURhdGEpID0+IHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQubmFtZX0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShmb3JtRGF0YS5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1EYXRhLmVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9ICcnO1xyXG59O1xyXG5cclxuY29uc3QgaXNWYWxpZCA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGlmIChpbnB1dEVsZW1lbnQudmFsaWRpdHkucGF0dGVybk1pc21hdGNoKSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuc2V0Q3VzdG9tVmFsaWRpdHkoaW5wdXRFbGVtZW50LmRhdGFzZXQuZXJyb3JNZXNzYWdlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSwgZm9ybURhdGEpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICB9KVxyXG59O1xyXG5cclxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoZm9ybURhdGEuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShmb3JtRGF0YS5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgZm9ybURhdGEpID0+IHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuaW5wdXRTZWxlY3RvcikpO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGZvcm1EYXRhLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBmb3JtRGF0YSk7XHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcclxuICAgICAgaXNWYWxpZChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGZvcm1EYXRhKSA9PiB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuZm9ybVNlbGVjdG9yKSk7XHJcblxyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XHJcblx0XHRmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgZm9ybURhdGEpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3QgY2xlYXJWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChmb3JtRGF0YS5pbnB1dFNlbGVjdG9yKSk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybURhdGEuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIFxyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgY2xlYXJWYWxpZGF0aW9uIH0iXSwibmFtZXMiOlsiY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJjb25jYXQiLCJzdGF0dXMiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwiYnV0dG9uIiwiYnV0dG9uVGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImxvYWRpbmdUZXh0IiwidGV4dENvbnRlbnQiLCJoYW5kbGVTdWJtaXQiLCJyZXF1ZXN0IiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRCdXR0b24iLCJzdWJtaXR0ZXIiLCJpbml0aWFsVGV4dCIsInRoZW4iLCJ0YXJnZXQiLCJyZXNldCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZmluYWxseSIsImNvbmZpZyIsImJhc2VVcmwiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsImVuZHBvaW50Iiwib3B0aW9ucyIsImZldGNoIiwiY2hhbmdlVXNlckF2YXRhciIsImxpbmtJbWFnZSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYXZhdGFyIiwidXNlcklkIiwiY3JlYXRlQ2FyZCIsImNhcmREYXRhIiwidXNlckRhdGFJZCIsItGBYWxsYmFja0ZvclJlbW92ZSIsItGBYWxsYmFja0Zvckxpa2UiLCLRgWFsbGJhY2tGb3JTaG93SW1hZ2UiLCJuZXdDYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIm5ld0NhcmRJbWFnZSIsIm5ld0NhcmRMaWtlQ291bnQiLCJuZXdDYXJkTGlrZUJ1dHRvbiIsIm5ld0NhcmREZWxldGVCdXR0b24iLCJuYW1lIiwic3JjIiwibGluayIsImFsdCIsImxpa2VzIiwiY2xhc3NMaXN0IiwiYWRkIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciIsInMiLCJuIiwiZG9uZSIsInZhbHVlIiwiZSIsImYiLCJvd25lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVDYXJkIiwiY2FyZElkIiwiY2xvc2VzdCIsInJlbW92ZSIsImxvZyIsImxpa2VDYXJkIiwibGlrZUJ1dHRvbiIsImxpa2VDb3VudCIsImNvbnRhaW5zIiwiZGVsZXRlTGlrZSIsInJlc3VsdCIsIm9wZW5Nb2RhbCIsInBvcHVwIiwiY2xvc2VNb2RhbE9uRXNjUHJlc3MiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsIm9wZW5lZFBvcHVwIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImZvcm1EYXRhIiwiZXJyb3JFbGVtZW50IiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZWQiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiY2xlYXJWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImZvckVhY2giLCJjYXJkQ29udGFpbmVyIiwidXNlck5hbWUiLCJ1c2VyRGVzY3JpcHRpb24iLCJ1c2VyQXZhdGFyIiwicG9wdXBzIiwiYnV0dG9uc0Nsb3NlUG9wdXBzIiwicHJvZmlsZUVkaXRQb3B1cCIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZUVkaXRGb3JtIiwiZm9ybXMiLCJuYW1lSW5wdXQiLCJlbGVtZW50cyIsImRlc2NyaXB0aW9uSW5wdXQiLCJkZXNjcmlwdGlvbiIsImNoYW5nZUF2YXRhclBvcHVwIiwiY2hhbmdlQXZhdGFyRm9ybSIsImNoYW5nZUF2YXRhcklucHV0IiwiYWRkTmV3Q2FyZFBvcHVwIiwiYWRkTmV3Q2FyZEJ1dHRvbiIsImFkZE5ld0NhcmRGb3JtIiwiY2FyZE5hbWVJbnB1dCIsImNhcmRsaW5rSW5wdXQiLCJzaG93SW1hZ2VQb3B1cCIsInBvcHVwSW1hZ2UiLCJwb3B1cEltYWdlQ2FwdGlvbiIsInZhbGlkYXRpb25Db25maWciLCJmb3JtU2VsZWN0b3IiLCJzaG93SW1hZ2UiLCJhbGwiLCJyZXN1bHRzIiwiX3Jlc3VsdHMiLCJ1c2VyRGF0YSIsImluaXRpYWxDYXJkcyIsImFib3V0Iiwic2V0QXR0cmlidXRlIiwiY2FyZCIsImFwcGVuZCIsIml0ZW0iLCJjdXJyZW50VGFyZ2V0IiwiY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayIsImNoYW5nZVVzZXJEYXRhIiwiY2FyZE5hbWUiLCJjYXJkTGluayIsInByZXBlbmQiLCJnZXQiLCJpbmNsdWRlcyIsInBhdHRlcm5NaXNtYXRjaCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZGF0YXNldCIsImVycm9yTWVzc2FnZSIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJpc1ZhbGlkIiwic2V0RXZlbnRMaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9
(()=>{"use strict";var e=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n},n=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";n.preventDefault();var o=n.submitter,a=o.textContent;t(!0,o,a,r),e().then((function(){n.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){t(!1,o,a)}))},r={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"25acbbe0-12c1-426d-be21-ec07addb3936","Content-Type":"application/json"}},o=function(t,n){return fetch("".concat(r.baseUrl,"/").concat(t),n).then(e)},a=function(e){return o("users/me/avatar",{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})})};function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i,l=function(e){var t=e.cardData,n=e.userDataId,r=e.сallbackForRemove,o=e.сallbackForLike,a=e.сallbackForShowImage,i=document.querySelector("#card-template").content.cloneNode(!0),l=i.querySelector(".card__image"),u=i.querySelector(".card__like-count"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__delete-button");if(i.querySelector(".card__title").textContent=t.name,l.src=t.link,l.alt=t.name,t.likes.length){u.textContent=t.likes.length,u.classList.add("card__like-count_is-active");var f,m=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(t.likes);try{for(m.s();!(f=m.n()).done;)f.value._id===n&&s.classList.add("card__like-button_is-active")}catch(e){m.e(e)}finally{m.f()}}return t.owner._id!==n&&d.classList.add("card__delete-button_hidden"),l.addEventListener("click",(function(){a(t)})),d.addEventListener("click",(function(e){r(e,t)})),i.querySelector(".card__like-button").addEventListener("click",(function(e){o(e,t)})),i},u=function(e,t){var n;(n=t._id,o("cards/".concat(n),{method:"DELETE",headers:r.headers})).then((function(){e.target.closest(".card").remove()})).catch((function(e){console.log(e)}))},s=function(e,t){var n,a=e.target,c=e.target.closest(".card__like-block").querySelector(".card__like-count");a.classList.contains("card__like-button_is-active")?function(e){return o("cards/likes/".concat(e),{method:"DELETE",headers:r.headers})}(t._id).then((function(e){a.classList.remove("card__like-button_is-active"),e.likes.length?c.textContent=e.likes.length:c.classList.remove("card__like-count_is-active")})).catch((function(e){console.log(e)})):(n=t._id,o("cards/likes/".concat(n),{method:"PUT",headers:r.headers})).then((function(e){a.classList.add("card__like-button_is-active"),c.classList.add("card__like-count_is-active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)}))},d=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",m)},f=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",m)},m=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");f(t)}},p=function(e,t,n){var r=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},v=function(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)},y=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}(t,n):v(t,n)},_=document.querySelector(".places__list"),h=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),S=document.querySelectorAll(".popup"),g=document.querySelectorAll(".popup__close"),L=document.querySelector(".popup_type_edit"),E=document.querySelector(".profile__edit-button"),C=document.forms["edit-profile"],q=C.elements.name,A=C.elements.description,w=document.querySelector(".popup_type_change-avatar"),x=document.forms["new-avatar"],I=x.elements.link,D=document.querySelector(".popup_type_new-card"),F=document.querySelector(".profile__add-button"),j=document.forms["new-place"],T=j.elements["place-name"],O=j.elements.link,P=document.querySelector(".popup_type_image"),B=document.querySelector(".popup__image"),M=document.querySelector(".popup__caption"),R={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N,H=function(e){d(P),B.src=e.link,B.alt=e.name,M.textContent=e.name};Promise.all([o("users/me",{headers:r.headers}),o("cards",{headers:r.headers})]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];i=o._id,h.textContent=o.name,b.textContent=o.about,k.setAttribute("style","background-image: url(".concat(o.avatar,");")),a.forEach((function(e){var t,n,r;n=(t={cardData:e,userDataId:i,сallbackForRemove:u,сallbackForLike:s,сallbackForShowImage:H}).cardData,r=l({cardData:n,userDataId:t.userDataId,сallbackForRemove:t.сallbackForRemove,сallbackForLike:t.сallbackForLike,сallbackForShowImage:t.сallbackForShowImage}),_.append(r)}))})).catch((function(e){console.log(e)})),g.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.closest(".popup");f(t)}))})),S.forEach((function(e){e.addEventListener("click",(function(t){!function(e,t){e.currentTarget===e.target&&f(t)}(t,e)}))})),E.addEventListener("click",(function(){var e,t,n,r;q.value=h.textContent,A.value=b.textContent,e=C,t=R,n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector),y(n,r,t),n.forEach((function(n){p(e,n,t)})),d(L)})),C.addEventListener("submit",(function(e){n((function(){return function(e,t){return o("users/me",{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})})}(q.value,A.value).then((function(e){h.textContent=e.name,b.textContent=e.about,f(L)}))}),e)})),F.addEventListener("click",(function(){d(D)})),j.addEventListener("submit",(function(e){n((function(){return(e=T.value,t=O.value,o("cards",{method:"POST",headers:r.headers,body:JSON.stringify({name:e,link:t})})).then((function(e){var t=l({cardData:e,userDataId:i,сallbackForRemove:u,сallbackForLike:s,сallbackForShowImage:H});_.prepend(t),f(D)}));var e,t}),e)})),k.addEventListener("click",(function(){d(w)})),x.addEventListener("submit",(function(e){n((function(){return Promise.all([(e=I.value,fetch("".concat(e),{method:"HEAD"}).then((function(e){if(!e.ok&&!e.headers.get("Content-Type").includes("image"))return Promise.reject("Ошибка: ".concat(e.status))}))),a(I.value)]).then((function(e){var t=e[1];k.setAttribute("style","background-image: url(".concat(t.avatar,");")),f(w)}));var e}),e)})),N=R,Array.from(document.querySelectorAll(N.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);y(n,r,t),e.addEventListener("reset",(function(){v(r,t)})),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),y(n,r,t)}))}))}(e,N)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBVTRDLFNBQVEsU0FBQ3RELEdBQ2pCQSxFQUFhckIsaUJBQWlCLFNBQVMsWUFqRDNCLFNBQUNvQixFQUFhQyxFQUFjQyxHQUN0Q0QsRUFBYVksU0FBU3dELGdCQUN4QnBFLEVBQWFxRSxrQkFBa0JyRSxFQUFhc0UsUUFBUUMsY0FFcER2RSxFQUFhcUUsa0JBQWtCLElBRzVCckUsRUFBYVksU0FBU0MsTUFHekJmLEVBQWVDLEVBQWFDLEVBQWNDLEdBeEJ2QixTQUFDRixFQUFhQyxFQUFjdUUsRUFBY3RFLEdBQy9ELElBQU1DLEVBQWVILEVBQVk1QyxjQUFjLElBQURsRCxPQUFLK0YsRUFBYXRDLEtBQUksV0FDcEVzQyxFQUFhakMsVUFBVUMsSUFBSWlDLEVBQVNFLGlCQUNwQ0QsRUFBYXZGLFlBQWM0SixFQUMzQnJFLEVBQWFuQyxVQUFVQyxJQUFJaUMsRUFBU0csV0FDdEMsQ0FpQklvRSxDQUFlekUsRUFBYUMsRUFBY0EsRUFBYXlFLGtCQUFtQnhFLEVBSTlFLENBc0NNeUUsQ0FBUTNFLEVBQWFDLEVBQWNDLEdBQ25DUSxFQUFrQkMsRUFBV0osRUFBZUwsRUFDOUMsR0FDRixHQUNGLENBU0kwRSxDQUFrQjVFLEVBQWFFLEVBQ2pDLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3V0aWxzL3V0aWxzLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy9hcGkuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL2NhcmQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL2luZGV4LmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy9tb2RhbC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3NjcmlwdHMvY29uc3RhbnRzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBjaGVja1Jlc3BvbnNlID0gKHJlcykgPT4ge1xuICBpZiAocmVzLm9rKSB7XG4gICAgcmV0dXJuIHJlcy5qc29uKClcbiAgfVxuICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYNCe0YjQuNCx0LrQsDogJHtyZXMuc3RhdHVzfWApO1xufVxuXG5jb25zdCByZW5kZXJMb2FkaW5nID0gKGlzTG9hZGluZywgYnV0dG9uLCBidXR0b25UZXh0ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCcsIGxvYWRpbmdUZXh0ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJykgPT4ge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHRcbiAgfSBlbHNlIHtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBidXR0b25UZXh0XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGhhbmRsZVN1Ym1pdCA9IChyZXF1ZXN0LCBldnQsIGxvYWRpbmdUZXh0ID0gXCLQodC+0YXRgNCw0L3QtdC90LjQtS4uLlwiKSA9PiB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQuc3VibWl0dGVyO1xuICBjb25zdCBpbml0aWFsVGV4dCA9IHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcblxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ1dHRvbiwgaW5pdGlhbFRleHQsIGxvYWRpbmdUZXh0KTtcbiAgcmVxdWVzdCgpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYNCe0YjQuNCx0LrQsDogJHtlcnJ9YCk7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBzdWJtaXRCdXR0b24sIGluaXRpYWxUZXh0KTtcbiAgICB9KTtcbn1cbiIsImltcG9ydCB7IGNoZWNrUmVzcG9uc2UgfSBmcm9tICcuLi91dGlscy91dGlscy5qcyc7XG5cbmNvbnN0IGNvbmZpZyA9IHtcbiAgYmFzZVVybDogJ2h0dHBzOi8vbWVzdG8ubm9tb3JlcGFydGllcy5jby92MS93ZmYtY29ob3J0LTInLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogJzI1YWNiYmUwLTEyYzEtNDI2ZC1iZTIxLWVjMDdhZGRiMzkzNicsXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICB9XG59XG5cbmNvbnN0IHJlcXVlc3QgPSAoZW5kcG9pbnQsIG9wdGlvbnMpID0+IHtcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS8ke2VuZHBvaW50fWAsIG9wdGlvbnMpLnRoZW4oY2hlY2tSZXNwb25zZSk7XG59XG5cbmV4cG9ydCBjb25zdCBnZXRVc2VyRGF0YSA9ICgpID0+IHtcbiAgcmV0dXJuIHJlcXVlc3QoJ3VzZXJzL21lJywge1xuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXG4gIH0pO1xufVxuXG5leHBvcnQgY29uc3QgY2hhbmdlVXNlckRhdGEgPSAodXNlck5hbWUsIHVzZXJEZXNjcmlwdGlvbikgPT4ge1xuICByZXR1cm4gcmVxdWVzdCgndXNlcnMvbWUnLCB7XG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIG5hbWU6IHVzZXJOYW1lLFxuICAgICAgYWJvdXQ6IHVzZXJEZXNjcmlwdGlvblxuICAgIH0pXG4gIH0pO1xufVxuXG5leHBvcnQgY29uc3QgY2hhbmdlVXNlckF2YXRhciA9IChsaW5rSW1hZ2UpID0+IHtcbiAgcmV0dXJuIHJlcXVlc3QoJ3VzZXJzL21lL2F2YXRhcicsIHtcbiAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgYXZhdGFyOiBsaW5rSW1hZ2VcbiAgICB9KVxuICB9KTtcbn1cblxuZXhwb3J0IGNvbnN0IGNoZWNrSW1hZ2VVcmwgPSAobGlua0ltYWdlKSA9PiB7XG4gIHJldHVybiBmZXRjaChgJHtsaW5rSW1hZ2V9YCwge1xuICAgIG1ldGhvZDogJ0hFQUQnLFxuICB9KVxuICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICBpZiAoIXJlcy5vayAmJiAhcmVzLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnKS5pbmNsdWRlcygnaW1hZ2UnKSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYNCe0YjQuNCx0LrQsDogJHtyZXMuc3RhdHVzfWApO1xuICAgICAgfVxuICAgIH0pO1xufVxuXG5leHBvcnQgY29uc3QgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xuICByZXR1cm4gcmVxdWVzdCgnY2FyZHMnLCB7XG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcbiAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBzZW5kTmV3Q2FyZCA9IChjYXJkTmFtZSwgY2FyZExpbmspID0+IHtcbiAgcmV0dXJuIHJlcXVlc3QoJ2NhcmRzJywge1xuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIG5hbWU6IGNhcmROYW1lLFxuICAgICAgbGluazogY2FyZExpbmtcbiAgICB9KVxuICB9KTtcbn1cblxuZXhwb3J0IGNvbnN0IGRlbGV0ZUN1cnJlbnRDYXJkID0gKGNhcmRJZCkgPT4ge1xuICByZXR1cm4gcmVxdWVzdChgY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcbiAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBwdXRMaWtlID0gKGNhcmRJZCkgPT4ge1xuICByZXR1cm4gcmVxdWVzdChgY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcbiAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCBkZWxldGVMaWtlID0gKGNhcmRJZCkgPT4ge1xuICByZXR1cm4gcmVxdWVzdChgY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcbiAgfSk7XG59XG4iLCJpbXBvcnQgeyBkZWxldGVDdXJyZW50Q2FyZCwgcHV0TGlrZSwgZGVsZXRlTGlrZSB9IGZyb20gXCIuL2FwaVwiO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlQ2FyZCA9ICh7IGNhcmREYXRhLCB1c2VyRGF0YUlkLCDRgWFsbGJhY2tGb3JSZW1vdmUsINGBYWxsYmFja0Zvckxpa2UsINGBYWxsYmFja0ZvclNob3dJbWFnZSB9KSA9PiB7XG4gIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYXJkLXRlbXBsYXRlJykuY29udGVudDtcbiAgY29uc3QgbmV3Q2FyZCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IG5ld0NhcmRJbWFnZSA9IG5ld0NhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2ltYWdlJyk7XG4gIGNvbnN0IG5ld0NhcmRMaWtlQ291bnQgPSBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50Jyk7XG4gIGNvbnN0IG5ld0NhcmRMaWtlQnV0dG9uID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKTtcbiAgY29uc3QgbmV3Q2FyZERlbGV0ZUJ1dHRvbiA9IG5ld0NhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2RlbGV0ZS1idXR0b24nKTtcblxuICBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcbiAgbmV3Q2FyZEltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gIG5ld0NhcmRJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xuXG4gIGlmIChjYXJkRGF0YS5saWtlcy5sZW5ndGgpIHtcbiAgICBuZXdDYXJkTGlrZUNvdW50LnRleHRDb250ZW50ID0gY2FyZERhdGEubGlrZXMubGVuZ3RoO1xuICAgIG5ld0NhcmRMaWtlQ291bnQuY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1jb3VudF9pcy1hY3RpdmUnKTtcblxuICAgIGZvciAoY29uc3Qgb3duZXJMaWtlIG9mIGNhcmREYXRhLmxpa2VzKSB7XG4gICAgICBpZiAob3duZXJMaWtlWydfaWQnXSA9PT0gdXNlckRhdGFJZCkge1xuICAgICAgICBuZXdDYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoY2FyZERhdGEub3duZXJbJ19pZCddICE9PSB1c2VyRGF0YUlkKSB7XG4gICAgbmV3Q2FyZERlbGV0ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjYXJkX19kZWxldGUtYnV0dG9uX2hpZGRlbicpO1xuICB9XG5cbiAgbmV3Q2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgINGBYWxsYmFja0ZvclNob3dJbWFnZShjYXJkRGF0YSk7XG4gIH0pO1xuICBuZXdDYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xuICAgINGBYWxsYmFja0ZvclJlbW92ZShldnQsIGNhcmREYXRhKTtcbiAgfSk7XG4gIG5ld0NhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG4gICAg0YFhbGxiYWNrRm9yTGlrZShldnQsIGNhcmREYXRhKTtcbiAgfSk7XG5cbiAgcmV0dXJuIG5ld0NhcmQ7XG59XG5cbmV4cG9ydCBjb25zdCByZW1vdmVDYXJkID0gKGV2dCwgY2FyZERhdGEpID0+IHtcbiAgZGVsZXRlQ3VycmVudENhcmQoY2FyZERhdGFbJ19pZCddKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGV2dC50YXJnZXQuY2xvc2VzdCgnLmNhcmQnKS5yZW1vdmUoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgY29uc3QgbGlrZUNhcmQgPSAoZXZ0LCBjYXJkRGF0YSkgPT4ge1xuICBjb25zdCBsaWtlQnV0dG9uID0gZXZ0LnRhcmdldDtcbiAgY29uc3QgbGlrZUNvdW50ID0gZXZ0LnRhcmdldC5jbG9zZXN0KCcuY2FyZF9fbGlrZS1ibG9jaycpLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50Jyk7XG5cbiAgaWYgKCFsaWtlQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJykpIHtcbiAgICBwdXRMaWtlKGNhcmREYXRhWydfaWQnXSlcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcbiAgICAgICAgbGlrZUNvdW50LmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtY291bnRfaXMtYWN0aXZlJyk7XG4gICAgICAgIGxpa2VDb3VudC50ZXh0Q29udGVudCA9IHJlc3VsdC5saWtlcy5sZW5ndGg7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGRlbGV0ZUxpa2UoY2FyZERhdGFbJ19pZCddKVxuICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xuICAgICAgICBpZiAocmVzdWx0Lmxpa2VzLmxlbmd0aCkge1xuICAgICAgICAgIGxpa2VDb3VudC50ZXh0Q29udGVudCA9IHJlc3VsdC5saWtlcy5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGlrZUNvdW50LmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2UtY291bnRfaXMtYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgfSk7XG4gIH1cbn0iLCJpbXBvcnQgJy4uL3BhZ2VzL2luZGV4LmNzcyc7XG5cbmltcG9ydCB7IGNyZWF0ZUNhcmQsIHJlbW92ZUNhcmQsIGxpa2VDYXJkIH0gZnJvbSAnLi9jYXJkLmpzJztcbmltcG9ydCB7IG9wZW5Nb2RhbCwgY2xvc2VNb2RhbCwgY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayB9IGZyb20gJy4vbW9kYWwuanMnO1xuaW1wb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgY2xlYXJWYWxpZGF0aW9uIH0gZnJvbSAnLi92YWxpZGF0aW9uLmpzJztcbmltcG9ydCB7IGdldFVzZXJEYXRhLCBjaGFuZ2VVc2VyRGF0YSwgZ2V0SW5pdGlhbENhcmRzLCBzZW5kTmV3Q2FyZCwgY2hhbmdlVXNlckF2YXRhciwgY2hlY2tJbWFnZVVybCB9IGZyb20gJy4vYXBpLmpzJztcbmltcG9ydCB7IGhhbmRsZVN1Ym1pdCB9IGZyb20gJy4uL3V0aWxzL3V0aWxzLmpzJztcbmltcG9ydCB7IGNhcmRDb250YWluZXIsIHVzZXJOYW1lLCB1c2VyRGVzY3JpcHRpb24sIHVzZXJBdmF0YXIsIHBvcHVwcywgYnV0dG9uc0Nsb3NlUG9wdXBzLCBwcm9maWxlRWRpdFBvcHVwLCBwcm9maWxlRWRpdEJ1dHRvbiwgcHJvZmlsZUVkaXRGb3JtLCBuYW1lSW5wdXQsIGRlc2NyaXB0aW9uSW5wdXQsIGNoYW5nZUF2YXRhclBvcHVwLCBjaGFuZ2VBdmF0YXJGb3JtLCBjaGFuZ2VBdmF0YXJJbnB1dCwgYWRkTmV3Q2FyZFBvcHVwLCBhZGROZXdDYXJkQnV0dG9uLCBhZGROZXdDYXJkRm9ybSwgY2FyZE5hbWVJbnB1dCwgY2FyZGxpbmtJbnB1dCwgc2hvd0ltYWdlUG9wdXAsIHBvcHVwSW1hZ2UsIHBvcHVwSW1hZ2VDYXB0aW9uLCB2YWxpZGF0aW9uQ29uZmlnIH0gZnJvbSAnLi9jb25zdGFudHMuanMnXG5cbmxldCB1c2VySWQ7XG5cbmNvbnN0IHJlbmRlckNhcmQgPSAoeyBjYXJkRGF0YSwgdXNlckRhdGFJZCwg0YFhbGxiYWNrRm9yUmVtb3ZlLCDRgWFsbGJhY2tGb3JMaWtlLCDRgWFsbGJhY2tGb3JTaG93SW1hZ2UgfSkgPT4ge1xuICBjb25zdCBuZXdDYXJkID0gY3JlYXRlQ2FyZCh7IGNhcmREYXRhLCB1c2VyRGF0YUlkLCDRgWFsbGJhY2tGb3JSZW1vdmUsINGBYWxsYmFja0Zvckxpa2UsINGBYWxsYmFja0ZvclNob3dJbWFnZSB9KTtcbiAgY2FyZENvbnRhaW5lci5hcHBlbmQobmV3Q2FyZCk7XG59XG5cbmNvbnN0IGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xuICBjb25zdCBtYWtlUmVxdWVzdCA9ICgpID0+IHtcbiAgICByZXR1cm4gY2hhbmdlVXNlckRhdGEobmFtZUlucHV0LnZhbHVlLCBkZXNjcmlwdGlvbklucHV0LnZhbHVlKVxuICAgICAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XG4gICAgICAgIHVzZXJOYW1lLnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZTtcbiAgICAgICAgdXNlckRlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XG4gICAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRQb3B1cCk7XG4gICAgICB9KVxuICB9XG5cbiAgaGFuZGxlU3VibWl0KG1ha2VSZXF1ZXN0LCBldnQpO1xufVxuXG5jb25zdCBoYW5kbGVDaGFuZ2VBdmF0YXJGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xuICBjb25zdCBtYWtlUmVxdWVzdCA9ICgpID0+IHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW2NoZWNrSW1hZ2VVcmwoY2hhbmdlQXZhdGFySW5wdXQudmFsdWUpLCBjaGFuZ2VVc2VyQXZhdGFyKGNoYW5nZUF2YXRhcklucHV0LnZhbHVlKV0pXG4gICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICBjb25zdCB1c2VyRGF0YSA9IHJlc3VsdHNbMV07XG4gICAgICAgIHVzZXJBdmF0YXIuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt1c2VyRGF0YS5hdmF0YXJ9KTtgKTtcbiAgICAgICAgY2xvc2VNb2RhbChjaGFuZ2VBdmF0YXJQb3B1cCk7XG4gICAgICB9KVxuICB9XG5cbiAgaGFuZGxlU3VibWl0KG1ha2VSZXF1ZXN0LCBldnQpO1xufVxuXG5jb25zdCBoYW5kbGVBZGROZXdDYXJkRm9ybVN1Ym1pdCA9IChldnQpID0+IHtcbiAgY29uc3QgbWFrZVJlcXVlc3QgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHNlbmROZXdDYXJkKGNhcmROYW1lSW5wdXQudmFsdWUsIGNhcmRsaW5rSW5wdXQudmFsdWUpXG4gICAgICAudGhlbigoY2FyZERhdGEpID0+IHtcbiAgICAgICAgY29uc3QgbmV3Q2FyZCA9IGNyZWF0ZUNhcmQoe1xuICAgICAgICAgICAgY2FyZERhdGE6IGNhcmREYXRhLCBcbiAgICAgICAgICAgIHVzZXJEYXRhSWQ6IHVzZXJJZCwgXG4gICAgICAgICAgICDRgWFsbGJhY2tGb3JSZW1vdmU6IHJlbW92ZUNhcmQsIFxuICAgICAgICAgICAg0YFhbGxiYWNrRm9yTGlrZTogbGlrZUNhcmQsIFxuICAgICAgICAgICAg0YFhbGxiYWNrRm9yU2hvd0ltYWdlOiBzaG93SW1hZ2UgXG4gICAgICAgICAgfSk7XG4gICAgICAgIGNhcmRDb250YWluZXIucHJlcGVuZChuZXdDYXJkKTtcbiAgICAgICAgY2xvc2VNb2RhbChhZGROZXdDYXJkUG9wdXApO1xuICAgICAgfSlcbiAgfVxuXG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0KTtcbn1cblxuY29uc3Qgc2hvd0ltYWdlID0gKGNhcmREYXRhKSA9PiB7XG4gIG9wZW5Nb2RhbChzaG93SW1hZ2VQb3B1cCk7XG4gIHBvcHVwSW1hZ2Uuc3JjID0gY2FyZERhdGEubGluaztcbiAgcG9wdXBJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xuICBwb3B1cEltYWdlQ2FwdGlvbi50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XG59XG5cblByb21pc2UuYWxsKFtnZXRVc2VyRGF0YSgpLCBnZXRJbml0aWFsQ2FyZHMoKV0pXG4gIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgY29uc3QgW3VzZXJEYXRhLCBpbml0aWFsQ2FyZHNdID0gcmVzdWx0cztcbiAgICB1c2VySWQgPSB1c2VyRGF0YVsnX2lkJ107XG4gICAgdXNlck5hbWUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xuICAgIHVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xuICAgIHVzZXJBdmF0YXIuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt1c2VyRGF0YS5hdmF0YXJ9KTtgKTtcblxuICAgIGluaXRpYWxDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgICByZW5kZXJDYXJkKHtcbiAgICAgICAgY2FyZERhdGE6IGNhcmQsIFxuICAgICAgICB1c2VyRGF0YUlkOiB1c2VySWQsIFxuICAgICAgICDRgWFsbGJhY2tGb3JSZW1vdmU6IHJlbW92ZUNhcmQsIFxuICAgICAgICDRgWFsbGJhY2tGb3JMaWtlOiBsaWtlQ2FyZCwgXG4gICAgICAgINGBYWxsYmFja0ZvclNob3dJbWFnZTogc2hvd0ltYWdlIFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSk7XG5cbmJ1dHRvbnNDbG9zZVBvcHVwcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBldnQudGFyZ2V0LmNsb3Nlc3QoJy5wb3B1cCcpO1xuICAgIGNsb3NlTW9kYWwob3BlbmVkUG9wdXApO1xuICB9KTtcbn0pO1xuXG5wb3B1cHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xuICAgIGNsb3NlTW9kYWxPbkJhY2tkcm9wQ2xpY2soZXZ0LCBpdGVtKTtcbiAgfSk7XG59KTtcblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IHVzZXJOYW1lLnRleHRDb250ZW50O1xuICBkZXNjcmlwdGlvbklucHV0LnZhbHVlID0gdXNlckRlc2NyaXB0aW9uLnRleHRDb250ZW50O1xuICBjbGVhclZhbGlkYXRpb24ocHJvZmlsZUVkaXRGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgb3Blbk1vZGFsKHByb2ZpbGVFZGl0UG9wdXApO1xufSk7XG5cbnByb2ZpbGVFZGl0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG5cbmFkZE5ld0NhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhZGROZXdDYXJkUG9wdXApO1xufSk7XG5cbmFkZE5ld0NhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZUFkZE5ld0NhcmRGb3JtU3VibWl0KTtcblxudXNlckF2YXRhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgb3Blbk1vZGFsKGNoYW5nZUF2YXRhclBvcHVwKTtcbn0pXG5cbmNoYW5nZUF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgaGFuZGxlQ2hhbmdlQXZhdGFyRm9ybVN1Ym1pdCk7XG5cbmVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkNvbmZpZyk7IiwiY29uc3Qgb3Blbk1vZGFsID0gKHBvcHVwKSA9PiB7XG4gIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX2lzLW9wZW5lZCcpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgY2xvc2VNb2RhbE9uRXNjUHJlc3MpO1xufVxuXG5jb25zdCBjbG9zZU1vZGFsID0gKHBvcHVwKSA9PiB7XG4gIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHVwX2lzLW9wZW5lZCcpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgY2xvc2VNb2RhbE9uRXNjUHJlc3MpO1xufVxuXG5jb25zdCBjbG9zZU1vZGFsT25Fc2NQcmVzcyA9IChldnQpID0+IHtcbiAgaWYgKGV2dC5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJyk7XG4gICAgY2xvc2VNb2RhbChvcGVuZWRQb3B1cCk7XG4gIH1cbn1cblxuY29uc3QgY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayA9IChldnQsIHBvcHVwKSA9PiB7XG4gIGlmIChldnQuY3VycmVudFRhcmdldCA9PT0gZXZ0LnRhcmdldCkgY2xvc2VNb2RhbChwb3B1cCk7XG59XG5cbmV4cG9ydCB7IG9wZW5Nb2RhbCwgY2xvc2VNb2RhbCwgY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayB9IiwiY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBmb3JtRGF0YSkgPT4ge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQubmFtZX0tZXJyb3JgKTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoZm9ybURhdGEuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChmb3JtRGF0YS5lcnJvckNsYXNzKTtcbn1cblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZm9ybURhdGEpID0+IHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50Lm5hbWV9LWVycm9yYCk7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1EYXRhLmlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1EYXRhLmVycm9yQ2xhc3MpO1xuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSAnJztcbn1cblxuY29uc3QgaXNWYWxpZCA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xuICBpZiAoaW5wdXRFbGVtZW50LnZhbGlkaXR5LnBhdHRlcm5NaXNtYXRjaCkge1xuICAgIGlucHV0RWxlbWVudC5zZXRDdXN0b21WYWxpZGl0eShpbnB1dEVsZW1lbnQuZGF0YXNldC5lcnJvck1lc3NhZ2UpO1xuICB9IGVsc2Uge1xuICAgIGlucHV0RWxlbWVudC5zZXRDdXN0b21WYWxpZGl0eShcIlwiKTtcbiAgfVxuXG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLCBmb3JtRGF0YSk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZm9ybURhdGEpO1xuICB9XG59XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcbiAgfSlcbn1cblxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGZvcm1EYXRhLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xufVxuXG5jb25zdCBlbmFibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoZm9ybURhdGEuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG59XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBmb3JtRGF0YSk7XG4gIH0gZWxzZSB7XG4gICAgZW5hYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIGZvcm1EYXRhKTtcbiAgfVxufVxuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgZm9ybURhdGEpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGZvcm1EYXRhLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybURhdGEuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xuXG4gIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgKCkgPT4ge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xuICB9KTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4ge1xuICAgICAgaXNWYWxpZChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGZvcm1EYXRhKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoZm9ybURhdGEpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuZm9ybVNlbGVjdG9yKSk7XG5cbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcblx0XHRmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgZm9ybURhdGEpO1xuICB9KTtcbn1cblxuY29uc3QgY2xlYXJWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuaW5wdXRTZWxlY3RvcikpO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtRGF0YS5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIFxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGZvcm1EYXRhKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZm9ybURhdGEpO1xuICB9KVxufVxuXG5leHBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCBjbGVhclZhbGlkYXRpb24gfSIsImV4cG9ydCBjb25zdCBjYXJkQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYWNlc19fbGlzdCcpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHVzZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3RpdGxlJyk7XHJcbmV4cG9ydCBjb25zdCB1c2VyRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fZGVzY3JpcHRpb24nKTtcclxuZXhwb3J0IGNvbnN0IHVzZXJBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuXHJcbmV4cG9ydCBjb25zdCBwb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXAnKTtcclxuZXhwb3J0IGNvbnN0IGJ1dHRvbnNDbG9zZVBvcHVwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cF9fY2xvc2UnKTtcclxuXHJcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfZWRpdCcpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fZWRpdC1idXR0b24nKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0Rm9ybSA9IGRvY3VtZW50LmZvcm1zWydlZGl0LXByb2ZpbGUnXTtcclxuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IHByb2ZpbGVFZGl0Rm9ybS5lbGVtZW50cy5uYW1lO1xyXG5leHBvcnQgY29uc3QgZGVzY3JpcHRpb25JbnB1dCA9IHByb2ZpbGVFZGl0Rm9ybS5lbGVtZW50cy5kZXNjcmlwdGlvbjtcclxuXHJcbmV4cG9ydCBjb25zdCBjaGFuZ2VBdmF0YXJQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2NoYW5nZS1hdmF0YXInKTtcclxuZXhwb3J0IGNvbnN0IGNoYW5nZUF2YXRhckZvcm0gPSBkb2N1bWVudC5mb3Jtc1snbmV3LWF2YXRhciddO1xyXG5leHBvcnQgY29uc3QgY2hhbmdlQXZhdGFySW5wdXQgPSBjaGFuZ2VBdmF0YXJGb3JtLmVsZW1lbnRzLmxpbms7XHJcblxyXG5leHBvcnQgY29uc3QgYWRkTmV3Q2FyZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfbmV3LWNhcmQnKTtcclxuZXhwb3J0IGNvbnN0IGFkZE5ld0NhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWRkLWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgYWRkTmV3Q2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtc1snbmV3LXBsYWNlJ107XHJcbmV4cG9ydCBjb25zdCBjYXJkTmFtZUlucHV0ID0gYWRkTmV3Q2FyZEZvcm0uZWxlbWVudHNbJ3BsYWNlLW5hbWUnXTtcclxuZXhwb3J0IGNvbnN0IGNhcmRsaW5rSW5wdXQgPSBhZGROZXdDYXJkRm9ybS5lbGVtZW50cy5saW5rO1xyXG5cclxuZXhwb3J0IGNvbnN0IHNob3dJbWFnZVBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ltYWdlJylcclxuZXhwb3J0IGNvbnN0IHBvcHVwSW1hZ2VDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19jYXB0aW9uJyk7XHJcblxyXG5leHBvcnQgY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcclxuICBmb3JtU2VsZWN0b3I6ICcucG9wdXBfX2Zvcm0nLFxyXG4gIGlucHV0U2VsZWN0b3I6ICcucG9wdXBfX2lucHV0JyxcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJy5wb3B1cF9fYnV0dG9uJyxcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiAncG9wdXBfX2J1dHRvbl9kaXNhYmxlZCcsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiAncG9wdXBfX2lucHV0X3R5cGVfZXJyb3InLFxyXG4gIGVycm9yQ2xhc3M6ICdwb3B1cF9fZXJyb3JfdmlzaWJsZSdcclxufSJdLCJuYW1lcyI6WyJjaGVja1Jlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsImNvbmNhdCIsInN0YXR1cyIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJidXR0b24iLCJidXR0b25UZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwibG9hZGluZ1RleHQiLCJ0ZXh0Q29udGVudCIsImhhbmRsZVN1Ym1pdCIsInJlcXVlc3QiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ1dHRvbiIsInN1Ym1pdHRlciIsImluaXRpYWxUZXh0IiwidGhlbiIsInRhcmdldCIsInJlc2V0IiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJmaW5hbGx5IiwiY29uZmlnIiwiYmFzZVVybCIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwiZW5kcG9pbnQiLCJvcHRpb25zIiwiZmV0Y2giLCJjaGFuZ2VVc2VyQXZhdGFyIiwibGlua0ltYWdlIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhdmF0YXIiLCJ1c2VySWQiLCJjcmVhdGVDYXJkIiwiX3JlZiIsImNhcmREYXRhIiwidXNlckRhdGFJZCIsItGBYWxsYmFja0ZvclJlbW92ZSIsItGBYWxsYmFja0Zvckxpa2UiLCLRgWFsbGJhY2tGb3JTaG93SW1hZ2UiLCJuZXdDYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIm5ld0NhcmRJbWFnZSIsIm5ld0NhcmRMaWtlQ291bnQiLCJuZXdDYXJkTGlrZUJ1dHRvbiIsIm5ld0NhcmREZWxldGVCdXR0b24iLCJuYW1lIiwic3JjIiwibGluayIsImFsdCIsImxpa2VzIiwiY2xhc3NMaXN0IiwiYWRkIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciIsInMiLCJuIiwiZG9uZSIsInZhbHVlIiwiZSIsImYiLCJvd25lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVDYXJkIiwiY2FyZElkIiwiY2xvc2VzdCIsInJlbW92ZSIsImxvZyIsImxpa2VDYXJkIiwibGlrZUJ1dHRvbiIsImxpa2VDb3VudCIsImNvbnRhaW5zIiwiZGVsZXRlTGlrZSIsInJlc3VsdCIsIm9wZW5Nb2RhbCIsInBvcHVwIiwiY2xvc2VNb2RhbE9uRXNjUHJlc3MiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsIm9wZW5lZFBvcHVwIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImZvcm1EYXRhIiwiZXJyb3JFbGVtZW50IiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImRpc2FibGVCdXR0b24iLCJidXR0b25FbGVtZW50IiwiZGlzYWJsZWQiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImVuYWJsZUJ1dHRvbiIsImNhcmRDb250YWluZXIiLCJ1c2VyTmFtZSIsInVzZXJEZXNjcmlwdGlvbiIsInVzZXJBdmF0YXIiLCJwb3B1cHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiYnV0dG9uc0Nsb3NlUG9wdXBzIiwicHJvZmlsZUVkaXRQb3B1cCIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZUVkaXRGb3JtIiwiZm9ybXMiLCJuYW1lSW5wdXQiLCJlbGVtZW50cyIsImRlc2NyaXB0aW9uSW5wdXQiLCJkZXNjcmlwdGlvbiIsImNoYW5nZUF2YXRhclBvcHVwIiwiY2hhbmdlQXZhdGFyRm9ybSIsImNoYW5nZUF2YXRhcklucHV0IiwiYWRkTmV3Q2FyZFBvcHVwIiwiYWRkTmV3Q2FyZEJ1dHRvbiIsImFkZE5ld0NhcmRGb3JtIiwiY2FyZE5hbWVJbnB1dCIsImNhcmRsaW5rSW5wdXQiLCJzaG93SW1hZ2VQb3B1cCIsInBvcHVwSW1hZ2UiLCJwb3B1cEltYWdlQ2FwdGlvbiIsInZhbGlkYXRpb25Db25maWciLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJzaG93SW1hZ2UiLCJhbGwiLCJyZXN1bHRzIiwiX3Jlc3VsdHMiLCJ1c2VyRGF0YSIsImluaXRpYWxDYXJkcyIsImFib3V0Iiwic2V0QXR0cmlidXRlIiwiZm9yRWFjaCIsImNhcmQiLCJhcHBlbmQiLCJpdGVtIiwiY3VycmVudFRhcmdldCIsImNsb3NlTW9kYWxPbkJhY2tkcm9wQ2xpY2siLCJBcnJheSIsImZyb20iLCJjaGFuZ2VVc2VyRGF0YSIsImNhcmROYW1lIiwiY2FyZExpbmsiLCJwcmVwZW5kIiwiZ2V0IiwiaW5jbHVkZXMiLCJwYXR0ZXJuTWlzbWF0Y2giLCJzZXRDdXN0b21WYWxpZGl0eSIsImRhdGFzZXQiLCJlcnJvck1lc3NhZ2UiLCJzaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiaXNWYWxpZCIsInNldEV2ZW50TGlzdGVuZXJzIl0sInNvdXJjZVJvb3QiOiIifQ==
(()=>{"use strict";var e=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n},n=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";n.preventDefault();var o=n.submitter,a=o.textContent;t(!0,o,a,r),e().then((function(){n.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){t(!1,o,a)}))},r={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"25acbbe0-12c1-426d-be21-ec07addb3936","Content-Type":"application/json"}},o=function(t,n){return fetch("".concat(r.baseUrl,"/").concat(t),n).then(e)},a=function(e){return o("users/me/avatar",{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})})};function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i,u,l=function(e){var t=e.cardData,n=e.userDataId,r=e.сallbackForRemove,o=e.сallbackForLike,a=e.сallbackForShowImage,i=document.querySelector("#card-template").content.cloneNode(!0),u=i.querySelector(".card__image"),l=i.querySelector(".card__like-count"),s=i.querySelector(".card__like-button"),d=i.querySelector(".card__delete-button");if(i.querySelector(".card__title").textContent=t.name,u.src=t.link,u.alt=t.name,t.likes.length){l.textContent=t.likes.length,l.classList.add("card__like-count_is-active");var f,m=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw a}}}}(t.likes);try{for(m.s();!(f=m.n()).done;)f.value._id===n&&s.classList.add("card__like-button_is-active")}catch(e){m.e(e)}finally{m.f()}}return t.owner._id!==n&&d.classList.add("card__delete-button_hidden"),u.addEventListener("click",(function(){a(t)})),d.addEventListener("click",(function(e){r(e,t)})),i.querySelector(".card__like-button").addEventListener("click",(function(e){o(e,t)})),i},s=function(e,t){var n,a=e.target,c=e.target.closest(".card__like-block").querySelector(".card__like-count");a.classList.contains("card__like-button_is-active")?function(e){return o("cards/likes/".concat(e),{method:"DELETE",headers:r.headers})}(t._id).then((function(e){a.classList.remove("card__like-button_is-active"),e.likes.length?c.textContent=e.likes.length:c.classList.remove("card__like-count_is-active")})).catch((function(e){console.log(e)})):(n=t._id,o("cards/likes/".concat(n),{method:"PUT",headers:r.headers})).then((function(e){a.classList.add("card__like-button_is-active"),c.classList.add("card__like-count_is-active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)}))},d=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",m)},f=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",m)},m=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");f(t)}},p=function(e,t,n){var r=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},v=function(e,t){e.disabled=!0,e.classList.add(t.inactiveButtonClass)},y=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)}(t,n):v(t,n)},_=document.querySelector(".places__list"),h=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),S=document.querySelectorAll(".popup"),g=document.querySelectorAll(".popup__close"),L=document.querySelector(".popup_type_edit"),E=document.querySelector(".profile__edit-button"),C=document.forms["edit-profile"],q=C.elements.name,A=C.elements.description,w=document.querySelector(".popup_type_change-avatar"),x=document.forms["new-avatar"],I=x.elements.link,D=document.querySelector(".popup_type_new-card"),F=document.querySelector(".profile__add-button"),j=document.forms["new-place"],T=j.elements["place-name"],O=j.elements.link,P=document.querySelector(".popup_type_image"),B=document.querySelector(".popup__image"),M=document.querySelector(".popup__caption"),R=document.querySelector(".popup_type_delete-card"),U=document.forms["remove-card"],N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var V,$=function(e,t){u=[e.target.closest(".card"),t._id],d(R)},z=function(e){d(P),B.src=e.link,B.alt=e.name,M.textContent=e.name};Promise.all([o("users/me",{headers:r.headers}),o("cards",{headers:r.headers})]).then((function(e){var t=H(e,2),n=t[0],r=t[1];i=n._id,h.textContent=n.name,b.textContent=n.about,k.setAttribute("style","background-image: url(".concat(n.avatar,");")),r.forEach((function(e){var t,n,r;n=(t={cardData:e,userDataId:i,сallbackForRemove:$,сallbackForLike:s,сallbackForShowImage:z}).cardData,r=l({cardData:n,userDataId:t.userDataId,сallbackForRemove:t.сallbackForRemove,сallbackForLike:t.сallbackForLike,сallbackForShowImage:t.сallbackForShowImage}),_.append(r)}))})).catch((function(e){console.log(e)})),g.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.closest(".popup");f(t)}))})),S.forEach((function(e){e.addEventListener("click",(function(t){!function(e,t){e.currentTarget===e.target&&f(t)}(t,e)}))})),E.addEventListener("click",(function(){var e,t,n,r;q.value=h.textContent,A.value=b.textContent,e=C,t=N,n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector),y(n,r,t),n.forEach((function(n){p(e,n,t)})),d(L)})),C.addEventListener("submit",(function(e){n((function(){return function(e,t){return o("users/me",{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})})}(q.value,A.value).then((function(e){h.textContent=e.name,b.textContent=e.about,f(L)}))}),e)})),F.addEventListener("click",(function(){d(D)})),j.addEventListener("submit",(function(e){n((function(){return(e=T.value,t=O.value,o("cards",{method:"POST",headers:r.headers,body:JSON.stringify({name:e,link:t})})).then((function(e){var t=l({cardData:e,userDataId:i,сallbackForRemove:$,сallbackForLike:s,сallbackForShowImage:z});_.prepend(t),f(D)}));var e,t}),e)})),U.addEventListener("submit",(function(e){var t=H(u,2),a=t[0],c=t[1];n((function(){return function(e){return o("cards/".concat(e),{method:"DELETE",headers:r.headers})}(c).then((function(){f(R),a.remove()}))}),e,"Удаление...")})),k.addEventListener("click",(function(){d(w)})),x.addEventListener("submit",(function(e){n((function(){return Promise.all([(e=I.value,fetch("".concat(e),{method:"HEAD"}).then((function(e){if(!e.ok&&!e.headers.get("Content-Type").includes("image"))return Promise.reject("Ошибка: ".concat(e.status))}))),a(I.value)]).then((function(e){var t=e[1];k.setAttribute("style","background-image: url(".concat(t.avatar,");")),f(w)}));var e}),e)})),V=N,Array.from(document.querySelectorAll(V.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);y(n,r,t),e.addEventListener("reset",(function(){n.length&&v(r,t)})),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),y(n,r,t)}))}))}(e,V)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFpQixVQUFVLFNBQUM5RCxHQUN0Q0EsRUFBSUMsZ0JBQ04sSUF4QnNCLFNBQUNnRixFQUFhRSxHQUN0QyxJQUFNUyxFQUFZc0QsTUFBTUMsS0FBS2xFLEVBQVlzQixpQkFBaUJwQixFQUFTNkMsZ0JBQzdEeEMsRUFBZ0JQLEVBQVkzQyxjQUFjNkMsRUFBUzhDLHNCQUV6RHRDLEVBQWtCQyxFQUFXSixFQUFlTCxHQUU1Q0YsRUFBWW5CLGlCQUFpQixTQUFTLFdBQ2hDOEIsRUFBVWxHLFFBQVE2RixFQUFjQyxFQUFlTCxFQUNyRCxJQUVBUyxFQUFVZ0QsU0FBUSxTQUFDMUQsR0FDakJBLEVBQWFwQixpQkFBaUIsU0FBUyxZQWpEM0IsU0FBQ21CLEVBQWFDLEVBQWNDLEdBQ3RDRCxFQUFhWSxTQUFTK0QsZ0JBQ3hCM0UsRUFBYTRFLGtCQUFrQjVFLEVBQWE2RSxRQUFRQyxjQUVwRDlFLEVBQWE0RSxrQkFBa0IsSUFHNUI1RSxFQUFhWSxTQUFTQyxNQUd6QmYsRUFBZUMsRUFBYUMsRUFBY0MsR0F4QnZCLFNBQUNGLEVBQWFDLEVBQWM4RSxFQUFjN0UsR0FDL0QsSUFBTUMsRUFBZUgsRUFBWTNDLGNBQWMsSUFBRG5ELE9BQUsrRixFQUFhckMsS0FBSSxXQUNwRXFDLEVBQWFoQyxVQUFVQyxJQUFJZ0MsRUFBU0UsaUJBQ3BDRCxFQUFhdkYsWUFBY21LLEVBQzNCNUUsRUFBYWxDLFVBQVVDLElBQUlnQyxFQUFTRyxXQUN0QyxDQWlCSTJFLENBQWVoRixFQUFhQyxFQUFjQSxFQUFhZ0Ysa0JBQW1CL0UsRUFJOUUsQ0FzQ01nRixDQUFRbEYsRUFBYUMsRUFBY0MsR0FDbkNRLEVBQWtCQyxFQUFXSixFQUFlTCxFQUM5QyxHQUNGLEdBQ0YsQ0FTSWlGLENBQWtCbkYsRUFBYUUsRUFDakMsRyIsInNvdXJjZXMiOlsid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvdXRpbHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL2FwaS5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3NjcmlwdHMvY2FyZC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL3NjcmlwdHMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy9jb25zdGFudHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGNoZWNrUmVzcG9uc2UgPSAocmVzKSA9PiB7XHJcbiAgaWYgKHJlcy5vaykge1xyXG4gICAgcmV0dXJuIHJlcy5qc29uKClcclxuICB9XHJcbiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LA6ICR7cmVzLnN0YXR1c31gKTtcclxufVxyXG5cclxuY29uc3QgcmVuZGVyTG9hZGluZyA9IChpc0xvYWRpbmcsIGJ1dHRvbiwgYnV0dG9uVGV4dCA9ICfQodC+0YXRgNCw0L3QuNGC0YwnLCBsb2FkaW5nVGV4dCA9ICfQodC+0YXRgNCw0L3QtdC90LjQtS4uLicpID0+IHtcclxuICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dFxyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBidXR0b25UZXh0XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgaGFuZGxlU3VibWl0ID0gKHJlcXVlc3QsIGV2dCwgbG9hZGluZ1RleHQgPSAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nKSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBjb25zdCBpbml0aWFsVGV4dCA9IHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcclxuXHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIGluaXRpYWxUZXh0LCBsb2FkaW5nVGV4dCk7XHJcbiAgcmVxdWVzdCgpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGDQntGI0LjQsdC60LA6ICR7ZXJyfWApO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uLCBpbml0aWFsVGV4dCk7XHJcbiAgICB9KTtcclxufVxyXG4iLCJpbXBvcnQgeyBjaGVja1Jlc3BvbnNlIH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMuanMnO1xyXG5cclxuY29uc3QgY29uZmlnID0ge1xyXG4gIGJhc2VVcmw6ICdodHRwczovL21lc3RvLm5vbW9yZXBhcnRpZXMuY28vdjEvd2ZmLWNvaG9ydC0yJyxcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiAnMjVhY2JiZTAtMTJjMS00MjZkLWJlMjEtZWMwN2FkZGIzOTM2JyxcclxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHJlcXVlc3QgPSAoZW5kcG9pbnQsIG9wdGlvbnMpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9LyR7ZW5kcG9pbnR9YCwgb3B0aW9ucykudGhlbihjaGVja1Jlc3BvbnNlKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGdldFVzZXJEYXRhID0gKCkgPT4ge1xyXG4gIHJldHVybiByZXF1ZXN0KCd1c2Vycy9tZScsIHtcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjaGFuZ2VVc2VyRGF0YSA9ICh1c2VyTmFtZSwgdXNlckRlc2NyaXB0aW9uKSA9PiB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoJ3VzZXJzL21lJywge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIG5hbWU6IHVzZXJOYW1lLFxyXG4gICAgICBhYm91dDogdXNlckRlc2NyaXB0aW9uXHJcbiAgICB9KVxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY2hhbmdlVXNlckF2YXRhciA9IChsaW5rSW1hZ2UpID0+IHtcclxuICByZXR1cm4gcmVxdWVzdCgndXNlcnMvbWUvYXZhdGFyJywge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogbGlua0ltYWdlXHJcbiAgICB9KVxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY2hlY2tJbWFnZVVybCA9IChsaW5rSW1hZ2UpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7bGlua0ltYWdlfWAsIHtcclxuICAgIG1ldGhvZDogJ0hFQUQnLFxyXG4gIH0pXHJcbiAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAoIXJlcy5vayAmJiAhcmVzLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnKS5pbmNsdWRlcygnaW1hZ2UnKSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xyXG4gIHJldHVybiByZXF1ZXN0KCdjYXJkcycsIHtcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzZW5kTmV3Q2FyZCA9IChjYXJkTmFtZSwgY2FyZExpbmspID0+IHtcclxuICByZXR1cm4gcmVxdWVzdCgnY2FyZHMnLCB7XHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBuYW1lOiBjYXJkTmFtZSxcclxuICAgICAgbGluazogY2FyZExpbmtcclxuICAgIH0pXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCByZW1vdmVDdXJyZW50Q2FyZCA9IChjYXJkSWQpID0+IHtcclxuICByZXR1cm4gcmVxdWVzdChgY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBwdXRMaWtlID0gKGNhcmRJZCkgPT4ge1xyXG4gIHJldHVybiByZXF1ZXN0KGBjYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGRlbGV0ZUxpa2UgPSAoY2FyZElkKSA9PiB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoYGNhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVyc1xyXG4gIH0pO1xyXG59XHJcbiIsImltcG9ydCB7IHB1dExpa2UsIGRlbGV0ZUxpa2UgfSBmcm9tIFwiLi9hcGlcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVDYXJkID0gKHsgY2FyZERhdGEsIHVzZXJEYXRhSWQsINGBYWxsYmFja0ZvclJlbW92ZSwg0YFhbGxiYWNrRm9yTGlrZSwg0YFhbGxiYWNrRm9yU2hvd0ltYWdlIH0pID0+IHtcclxuICBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2FyZC10ZW1wbGF0ZScpLmNvbnRlbnQ7XHJcbiAgY29uc3QgbmV3Q2FyZCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgY29uc3QgbmV3Q2FyZEltYWdlID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9faW1hZ2UnKTtcclxuICBjb25zdCBuZXdDYXJkTGlrZUNvdW50ID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpO1xyXG4gIGNvbnN0IG5ld0NhcmRMaWtlQnV0dG9uID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKTtcclxuICBjb25zdCBuZXdDYXJkRGVsZXRlQnV0dG9uID0gbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpO1xyXG5cclxuICBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcclxuICBuZXdDYXJkSW1hZ2Uuc3JjID0gY2FyZERhdGEubGluaztcclxuICBuZXdDYXJkSW1hZ2UuYWx0ID0gY2FyZERhdGEubmFtZTtcclxuXHJcbiAgaWYgKGNhcmREYXRhLmxpa2VzLmxlbmd0aCkge1xyXG4gICAgbmV3Q2FyZExpa2VDb3VudC50ZXh0Q29udGVudCA9IGNhcmREYXRhLmxpa2VzLmxlbmd0aDtcclxuICAgIG5ld0NhcmRMaWtlQ291bnQuY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1jb3VudF9pcy1hY3RpdmUnKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IG93bmVyTGlrZSBvZiBjYXJkRGF0YS5saWtlcykge1xyXG4gICAgICBpZiAob3duZXJMaWtlWydfaWQnXSA9PT0gdXNlckRhdGFJZCkge1xyXG4gICAgICAgIG5ld0NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpZiAoY2FyZERhdGEub3duZXJbJ19pZCddICE9PSB1c2VyRGF0YUlkKSB7XHJcbiAgICBuZXdDYXJkRGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2RlbGV0ZS1idXR0b25faGlkZGVuJyk7XHJcbiAgfVxyXG5cclxuICBuZXdDYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICDRgWFsbGJhY2tGb3JTaG93SW1hZ2UoY2FyZERhdGEpO1xyXG4gIH0pO1xyXG4gIG5ld0NhcmREZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XHJcbiAgICDRgWFsbGJhY2tGb3JSZW1vdmUoZXZ0LCBjYXJkRGF0YSk7XHJcbiAgfSk7XHJcbiAgbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICAgINGBYWxsYmFja0Zvckxpa2UoZXZ0LCBjYXJkRGF0YSk7XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBuZXdDYXJkO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgbGlrZUNhcmQgPSAoZXZ0LCBjYXJkRGF0YSkgPT4ge1xyXG4gIGNvbnN0IGxpa2VCdXR0b24gPSBldnQudGFyZ2V0O1xyXG4gIGNvbnN0IGxpa2VDb3VudCA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLmNhcmRfX2xpa2UtYmxvY2snKS5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpO1xyXG5cclxuICBpZiAoIWxpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKSkge1xyXG4gICAgcHV0TGlrZShjYXJkRGF0YVsnX2lkJ10pXHJcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIGxpa2VDb3VudC5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWNvdW50X2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIGxpa2VDb3VudC50ZXh0Q29udGVudCA9IHJlc3VsdC5saWtlcy5sZW5ndGg7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGRlbGV0ZUxpa2UoY2FyZERhdGFbJ19pZCddKVxyXG4gICAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcclxuICAgICAgICBpZiAocmVzdWx0Lmxpa2VzLmxlbmd0aCkge1xyXG4gICAgICAgICAgbGlrZUNvdW50LnRleHRDb250ZW50ID0gcmVzdWx0Lmxpa2VzLmxlbmd0aDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbGlrZUNvdW50LmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2UtY291bnRfaXMtYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufSIsImltcG9ydCAnLi4vcGFnZXMvaW5kZXguY3NzJztcclxuXHJcbmltcG9ydCB7IGNyZWF0ZUNhcmQsIGxpa2VDYXJkIH0gZnJvbSAnLi9jYXJkLmpzJztcclxuaW1wb3J0IHsgb3Blbk1vZGFsLCBjbG9zZU1vZGFsLCBjbG9zZU1vZGFsT25CYWNrZHJvcENsaWNrIH0gZnJvbSAnLi9tb2RhbC5qcyc7XHJcbmltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIGNsZWFyVmFsaWRhdGlvbiB9IGZyb20gJy4vdmFsaWRhdGlvbi5qcyc7XHJcbmltcG9ydCB7IGdldFVzZXJEYXRhLCBjaGFuZ2VVc2VyRGF0YSwgZ2V0SW5pdGlhbENhcmRzLCBzZW5kTmV3Q2FyZCwgcmVtb3ZlQ3VycmVudENhcmQsIGNoYW5nZVVzZXJBdmF0YXIsIGNoZWNrSW1hZ2VVcmwgfSBmcm9tICcuL2FwaS5qcyc7XHJcbmltcG9ydCB7IGhhbmRsZVN1Ym1pdCB9IGZyb20gJy4uL3V0aWxzL3V0aWxzLmpzJztcclxuaW1wb3J0IHsgY2FyZENvbnRhaW5lciwgdXNlck5hbWUsIHVzZXJEZXNjcmlwdGlvbiwgdXNlckF2YXRhciwgcG9wdXBzLCBidXR0b25zQ2xvc2VQb3B1cHMsIHByb2ZpbGVFZGl0UG9wdXAsIHByb2ZpbGVFZGl0QnV0dG9uLCBwcm9maWxlRWRpdEZvcm0sIG5hbWVJbnB1dCwgZGVzY3JpcHRpb25JbnB1dCwgY2hhbmdlQXZhdGFyUG9wdXAsIGNoYW5nZUF2YXRhckZvcm0sIGNoYW5nZUF2YXRhcklucHV0LCBhZGROZXdDYXJkUG9wdXAsIGFkZE5ld0NhcmRCdXR0b24sIGFkZE5ld0NhcmRGb3JtLCBjYXJkTmFtZUlucHV0LCBjYXJkbGlua0lucHV0LCBzaG93SW1hZ2VQb3B1cCwgcG9wdXBJbWFnZSwgcG9wdXBJbWFnZUNhcHRpb24sIHJlbW92ZUNhcmRQb3B1cCwgcmVtb3ZlQ2FyZEZvcm0sIHZhbGlkYXRpb25Db25maWcgfSBmcm9tICcuL2NvbnN0YW50cy5qcydcclxuXHJcbmxldCB1c2VySWQ7XHJcbmxldCBjYXJkRGF0YUZvclJlbW92ZTtcclxuXHJcbmNvbnN0IHJlbmRlckNhcmQgPSAoeyBjYXJkRGF0YSwgdXNlckRhdGFJZCwg0YFhbGxiYWNrRm9yUmVtb3ZlLCDRgWFsbGJhY2tGb3JMaWtlLCDRgWFsbGJhY2tGb3JTaG93SW1hZ2UgfSkgPT4ge1xyXG4gIGNvbnN0IG5ld0NhcmQgPSBjcmVhdGVDYXJkKHsgY2FyZERhdGEsIHVzZXJEYXRhSWQsINGBYWxsYmFja0ZvclJlbW92ZSwg0YFhbGxiYWNrRm9yTGlrZSwg0YFhbGxiYWNrRm9yU2hvd0ltYWdlIH0pO1xyXG4gIGNhcmRDb250YWluZXIuYXBwZW5kKG5ld0NhcmQpO1xyXG59XHJcblxyXG5jb25zdCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCA9IChldnQpID0+IHtcclxuICBjb25zdCBtYWtlUmVxdWVzdCA9ICgpID0+IHtcclxuICAgIHJldHVybiBjaGFuZ2VVc2VyRGF0YShuYW1lSW5wdXQudmFsdWUsIGRlc2NyaXB0aW9uSW5wdXQudmFsdWUpXHJcbiAgICAgIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xyXG4gICAgICAgIHVzZXJOYW1lLnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZTtcclxuICAgICAgICB1c2VyRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICAgICAgICBjbG9zZU1vZGFsKHByb2ZpbGVFZGl0UG9wdXApO1xyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlU3VibWl0KG1ha2VSZXF1ZXN0LCBldnQpO1xyXG59XHJcblxyXG5jb25zdCBoYW5kbGVDaGFuZ2VBdmF0YXJGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xyXG4gIGNvbnN0IG1ha2VSZXF1ZXN0ID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtjaGVja0ltYWdlVXJsKGNoYW5nZUF2YXRhcklucHV0LnZhbHVlKSwgY2hhbmdlVXNlckF2YXRhcihjaGFuZ2VBdmF0YXJJbnB1dC52YWx1ZSldKVxyXG4gICAgICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVzZXJEYXRhID0gcmVzdWx0c1sxXTtcclxuICAgICAgICB1c2VyQXZhdGFyLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7dXNlckRhdGEuYXZhdGFyfSk7YCk7XHJcbiAgICAgICAgY2xvc2VNb2RhbChjaGFuZ2VBdmF0YXJQb3B1cCk7XHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICBoYW5kbGVTdWJtaXQobWFrZVJlcXVlc3QsIGV2dCk7XHJcbn1cclxuXHJcbmNvbnN0IGhhbmRsZUFkZE5ld0NhcmRGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xyXG4gIGNvbnN0IG1ha2VSZXF1ZXN0ID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIHNlbmROZXdDYXJkKGNhcmROYW1lSW5wdXQudmFsdWUsIGNhcmRsaW5rSW5wdXQudmFsdWUpXHJcbiAgICAgIC50aGVuKChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5ld0NhcmQgPSBjcmVhdGVDYXJkKHtcclxuICAgICAgICAgIGNhcmREYXRhOiBjYXJkRGF0YSxcclxuICAgICAgICAgIHVzZXJEYXRhSWQ6IHVzZXJJZCxcclxuICAgICAgICAgINGBYWxsYmFja0ZvclJlbW92ZTogcmVtb3ZlQ2FyZCxcclxuICAgICAgICAgINGBYWxsYmFja0Zvckxpa2U6IGxpa2VDYXJkLFxyXG4gICAgICAgICAg0YFhbGxiYWNrRm9yU2hvd0ltYWdlOiBzaG93SW1hZ2VcclxuICAgICAgICB9KTtcclxuICAgICAgICBjYXJkQ29udGFpbmVyLnByZXBlbmQobmV3Q2FyZCk7XHJcbiAgICAgICAgY2xvc2VNb2RhbChhZGROZXdDYXJkUG9wdXApO1xyXG4gICAgICB9KVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlU3VibWl0KG1ha2VSZXF1ZXN0LCBldnQpO1xyXG59XHJcblxyXG5jb25zdCByZW1vdmVDYXJkID0gKGV2dCwgY2FyZERhdGEpID0+IHtcclxuICBjYXJkRGF0YUZvclJlbW92ZSA9IFtldnQudGFyZ2V0LmNsb3Nlc3QoJy5jYXJkJyksIGNhcmREYXRhWydfaWQnXV07XHJcbiAgb3Blbk1vZGFsKHJlbW92ZUNhcmRQb3B1cCk7XHJcbn1cclxuXHJcbmNvbnN0IGhhbmRsZVJlbW92ZUNhcmRGb3JtU3VibWl0ID0gKGV2dCkgPT4ge1xyXG4gIGNvbnN0IFtjdXJyZW50Q2FyZCwgY2FyZElkXSA9IGNhcmREYXRhRm9yUmVtb3ZlO1xyXG4gIGNvbnN0IG1ha2VSZXF1ZXN0ID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIHJlbW92ZUN1cnJlbnRDYXJkKGNhcmRJZClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNsb3NlTW9kYWwocmVtb3ZlQ2FyZFBvcHVwKTtcclxuICAgICAgICBjdXJyZW50Q2FyZC5yZW1vdmUoKTtcclxuICAgICAgfSlcclxuICB9XHJcblxyXG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0LCAn0KPQtNCw0LvQtdC90LjQtS4uLicpO1xyXG59O1xyXG5cclxuY29uc3Qgc2hvd0ltYWdlID0gKGNhcmREYXRhKSA9PiB7XHJcbiAgb3Blbk1vZGFsKHNob3dJbWFnZVBvcHVwKTtcclxuICBwb3B1cEltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XHJcbiAgcG9wdXBJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xyXG4gIHBvcHVwSW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcclxufVxyXG5cclxuUHJvbWlzZS5hbGwoW2dldFVzZXJEYXRhKCksIGdldEluaXRpYWxDYXJkcygpXSlcclxuICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgY29uc3QgW3VzZXJEYXRhLCBpbml0aWFsQ2FyZHNdID0gcmVzdWx0cztcclxuICAgIHVzZXJJZCA9IHVzZXJEYXRhWydfaWQnXTtcclxuICAgIHVzZXJOYW1lLnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZTtcclxuICAgIHVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJEYXRhLmFib3V0O1xyXG4gICAgdXNlckF2YXRhci5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYGJhY2tncm91bmQtaW1hZ2U6IHVybCgke3VzZXJEYXRhLmF2YXRhcn0pO2ApO1xyXG5cclxuICAgIGluaXRpYWxDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgIHJlbmRlckNhcmQoe1xyXG4gICAgICAgIGNhcmREYXRhOiBjYXJkLFxyXG4gICAgICAgIHVzZXJEYXRhSWQ6IHVzZXJJZCxcclxuICAgICAgICDRgWFsbGJhY2tGb3JSZW1vdmU6IHJlbW92ZUNhcmQsXHJcbiAgICAgICAg0YFhbGxiYWNrRm9yTGlrZTogbGlrZUNhcmQsXHJcbiAgICAgICAg0YFhbGxiYWNrRm9yU2hvd0ltYWdlOiBzaG93SW1hZ2VcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pO1xyXG5cclxuYnV0dG9uc0Nsb3NlUG9wdXBzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBldnQudGFyZ2V0LmNsb3Nlc3QoJy5wb3B1cCcpO1xyXG4gICAgY2xvc2VNb2RhbChvcGVuZWRQb3B1cCk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxucG9wdXBzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAgY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayhldnQsIGl0ZW0pO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG5hbWVJbnB1dC52YWx1ZSA9IHVzZXJOYW1lLnRleHRDb250ZW50O1xyXG4gIGRlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSB1c2VyRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XHJcbiAgY2xlYXJWYWxpZGF0aW9uKHByb2ZpbGVFZGl0Rm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgb3Blbk1vZGFsKHByb2ZpbGVFZGl0UG9wdXApO1xyXG59KTtcclxuXHJcbnByb2ZpbGVFZGl0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcblxyXG5hZGROZXdDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG9wZW5Nb2RhbChhZGROZXdDYXJkUG9wdXApO1xyXG59KTtcclxuXHJcbmFkZE5ld0NhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZUFkZE5ld0NhcmRGb3JtU3VibWl0KTtcclxuXHJcbnJlbW92ZUNhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZVJlbW92ZUNhcmRGb3JtU3VibWl0KTtcclxuXHJcbnVzZXJBdmF0YXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgb3Blbk1vZGFsKGNoYW5nZUF2YXRhclBvcHVwKTtcclxufSlcclxuXHJcbmNoYW5nZUF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgaGFuZGxlQ2hhbmdlQXZhdGFyRm9ybVN1Ym1pdCk7XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpOyIsImNvbnN0IG9wZW5Nb2RhbCA9IChwb3B1cCkgPT4ge1xyXG4gIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBjbG9zZU1vZGFsT25Fc2NQcmVzcyk7XHJcbn1cclxuXHJcbmNvbnN0IGNsb3NlTW9kYWwgPSAocG9wdXApID0+IHtcclxuICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdwb3B1cF9pcy1vcGVuZWQnKTtcclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgY2xvc2VNb2RhbE9uRXNjUHJlc3MpO1xyXG59XHJcblxyXG5jb25zdCBjbG9zZU1vZGFsT25Fc2NQcmVzcyA9IChldnQpID0+IHtcclxuICBpZiAoZXZ0LmtleSA9PT0gJ0VzY2FwZScpIHtcclxuICAgIGNvbnN0IG9wZW5lZFBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX2lzLW9wZW5lZCcpO1xyXG4gICAgY2xvc2VNb2RhbChvcGVuZWRQb3B1cCk7XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBjbG9zZU1vZGFsT25CYWNrZHJvcENsaWNrID0gKGV2dCwgcG9wdXApID0+IHtcclxuICBpZiAoZXZ0LmN1cnJlbnRUYXJnZXQgPT09IGV2dC50YXJnZXQpIGNsb3NlTW9kYWwocG9wdXApO1xyXG59XHJcblxyXG5leHBvcnQgeyBvcGVuTW9kYWwsIGNsb3NlTW9kYWwsIGNsb3NlTW9kYWxPbkJhY2tkcm9wQ2xpY2sgfSIsImNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgZm9ybURhdGEpID0+IHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQubmFtZX0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChmb3JtRGF0YS5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChmb3JtRGF0YS5lcnJvckNsYXNzKTtcclxufVxyXG5cclxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZm9ybURhdGEpID0+IHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQubmFtZX0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShmb3JtRGF0YS5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1EYXRhLmVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9ICcnO1xyXG59XHJcblxyXG5jb25zdCBpc1ZhbGlkID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGZvcm1EYXRhKSA9PiB7XHJcbiAgaWYgKGlucHV0RWxlbWVudC52YWxpZGl0eS5wYXR0ZXJuTWlzbWF0Y2gpIHtcclxuICAgIGlucHV0RWxlbWVudC5zZXRDdXN0b21WYWxpZGl0eShpbnB1dEVsZW1lbnQuZGF0YXNldC5lcnJvck1lc3NhZ2UpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuc2V0Q3VzdG9tVmFsaWRpdHkoXCJcIik7XHJcbiAgfVxyXG5cclxuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLCBmb3JtRGF0YSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGZvcm1EYXRhKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcclxuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgfSlcclxufVxyXG5cclxuY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChmb3JtRGF0YS5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxufVxyXG5cclxuY29uc3QgZW5hYmxlQnV0dG9uID0gKGJ1dHRvbkVsZW1lbnQsIGZvcm1EYXRhKSA9PiB7XHJcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShmb3JtRGF0YS5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxufVxyXG5cclxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGVuYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgZm9ybURhdGEpID0+IHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuaW5wdXRTZWxlY3RvcikpO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGZvcm1EYXRhLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBmb3JtRGF0YSk7XHJcblxyXG4gIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2V0JywgKCkgPT4ge1xyXG4gICAgaWYgKGlucHV0TGlzdC5sZW5ndGgpIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xyXG4gIH0pO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XHJcbiAgICAgIGlzVmFsaWQoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZm9ybURhdGEpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGZvcm1EYXRhKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGZvcm1EYXRhKSA9PiB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuZm9ybVNlbGVjdG9yKSk7XHJcblxyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XHJcbiAgICBmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgZm9ybURhdGEpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5jb25zdCBjbGVhclZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGZvcm1EYXRhKSA9PiB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGZvcm1EYXRhLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihmb3JtRGF0YS5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgY2xlYXJWYWxpZGF0aW9uIH0iLCJleHBvcnQgY29uc3QgY2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGFjZXNfX2xpc3QnKTtcclxuXHJcbmV4cG9ydCBjb25zdCB1c2VyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5leHBvcnQgY29uc3QgdXNlckRlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2Rlc2NyaXB0aW9uJyk7XHJcbmV4cG9ydCBjb25zdCB1c2VyQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2ltYWdlJyk7XHJcblxyXG5leHBvcnQgY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwJyk7XHJcbmV4cG9ydCBjb25zdCBidXR0b25zQ2xvc2VQb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXBfX2Nsb3NlJyk7XHJcblxyXG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2VkaXQnKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1snZWRpdC1wcm9maWxlJ107XHJcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBwcm9maWxlRWRpdEZvcm0uZWxlbWVudHMubmFtZTtcclxuZXhwb3J0IGNvbnN0IGRlc2NyaXB0aW9uSW5wdXQgPSBwcm9maWxlRWRpdEZvcm0uZWxlbWVudHMuZGVzY3JpcHRpb247XHJcblxyXG5leHBvcnQgY29uc3QgY2hhbmdlQXZhdGFyUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9jaGFuZ2UtYXZhdGFyJyk7XHJcbmV4cG9ydCBjb25zdCBjaGFuZ2VBdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbJ25ldy1hdmF0YXInXTtcclxuZXhwb3J0IGNvbnN0IGNoYW5nZUF2YXRhcklucHV0ID0gY2hhbmdlQXZhdGFyRm9ybS5lbGVtZW50cy5saW5rO1xyXG5cclxuZXhwb3J0IGNvbnN0IGFkZE5ld0NhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX25ldy1jYXJkJyk7XHJcbmV4cG9ydCBjb25zdCBhZGROZXdDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKTtcclxuZXhwb3J0IGNvbnN0IGFkZE5ld0NhcmRGb3JtID0gZG9jdW1lbnQuZm9ybXNbJ25ldy1wbGFjZSddO1xyXG5leHBvcnQgY29uc3QgY2FyZE5hbWVJbnB1dCA9IGFkZE5ld0NhcmRGb3JtLmVsZW1lbnRzWydwbGFjZS1uYW1lJ107XHJcbmV4cG9ydCBjb25zdCBjYXJkbGlua0lucHV0ID0gYWRkTmV3Q2FyZEZvcm0uZWxlbWVudHMubGluaztcclxuXHJcbmV4cG9ydCBjb25zdCBzaG93SW1hZ2VQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2ltYWdlJyk7XHJcbmV4cG9ydCBjb25zdCBwb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpXHJcbmV4cG9ydCBjb25zdCBwb3B1cEltYWdlQ2FwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fY2FwdGlvbicpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHJlbW92ZUNhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2RlbGV0ZS1jYXJkJyk7XHJcbmV4cG9ydCBjb25zdCByZW1vdmVDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zWydyZW1vdmUtY2FyZCddO1xyXG5cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiAnLnBvcHVwX19mb3JtJyxcclxuICBpbnB1dFNlbGVjdG9yOiAnLnBvcHVwX19pbnB1dCcsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcucG9wdXBfX2J1dHRvbicsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogJ3BvcHVwX19idXR0b25fZGlzYWJsZWQnLFxyXG4gIGlucHV0RXJyb3JDbGFzczogJ3BvcHVwX19pbnB1dF90eXBlX2Vycm9yJyxcclxuICBlcnJvckNsYXNzOiAncG9wdXBfX2Vycm9yX3Zpc2libGUnXHJcbn0iXSwibmFtZXMiOlsiY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJjb25jYXQiLCJzdGF0dXMiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwiYnV0dG9uIiwiYnV0dG9uVGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImxvYWRpbmdUZXh0IiwidGV4dENvbnRlbnQiLCJoYW5kbGVTdWJtaXQiLCJyZXF1ZXN0IiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRCdXR0b24iLCJzdWJtaXR0ZXIiLCJpbml0aWFsVGV4dCIsInRoZW4iLCJ0YXJnZXQiLCJyZXNldCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiZmluYWxseSIsImNvbmZpZyIsImJhc2VVcmwiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsImVuZHBvaW50Iiwib3B0aW9ucyIsImZldGNoIiwiY2hhbmdlVXNlckF2YXRhciIsImxpbmtJbWFnZSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYXZhdGFyIiwidXNlcklkIiwiY2FyZERhdGFGb3JSZW1vdmUiLCJjcmVhdGVDYXJkIiwiX3JlZiIsImNhcmREYXRhIiwidXNlckRhdGFJZCIsItGBYWxsYmFja0ZvclJlbW92ZSIsItGBYWxsYmFja0Zvckxpa2UiLCLRgWFsbGJhY2tGb3JTaG93SW1hZ2UiLCJuZXdDYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsIm5ld0NhcmRJbWFnZSIsIm5ld0NhcmRMaWtlQ291bnQiLCJuZXdDYXJkTGlrZUJ1dHRvbiIsIm5ld0NhcmREZWxldGVCdXR0b24iLCJuYW1lIiwic3JjIiwibGluayIsImFsdCIsImxpa2VzIiwiY2xhc3NMaXN0IiwiYWRkIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciIsInMiLCJuIiwiZG9uZSIsInZhbHVlIiwiZSIsImYiLCJvd25lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJsaWtlQ2FyZCIsImNhcmRJZCIsImxpa2VCdXR0b24iLCJsaWtlQ291bnQiLCJjbG9zZXN0IiwiY29udGFpbnMiLCJkZWxldGVMaWtlIiwicmVzdWx0IiwicmVtb3ZlIiwibG9nIiwib3Blbk1vZGFsIiwicG9wdXAiLCJjbG9zZU1vZGFsT25Fc2NQcmVzcyIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5Iiwib3BlbmVkUG9wdXAiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiZm9ybURhdGEiLCJlcnJvckVsZW1lbnQiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiZGlzYWJsZUJ1dHRvbiIsImJ1dHRvbkVsZW1lbnQiLCJkaXNhYmxlZCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZW5hYmxlQnV0dG9uIiwiY2FyZENvbnRhaW5lciIsInVzZXJOYW1lIiwidXNlckRlc2NyaXB0aW9uIiwidXNlckF2YXRhciIsInBvcHVwcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b25zQ2xvc2VQb3B1cHMiLCJwcm9maWxlRWRpdFBvcHVwIiwicHJvZmlsZUVkaXRCdXR0b24iLCJwcm9maWxlRWRpdEZvcm0iLCJmb3JtcyIsIm5hbWVJbnB1dCIsImVsZW1lbnRzIiwiZGVzY3JpcHRpb25JbnB1dCIsImRlc2NyaXB0aW9uIiwiY2hhbmdlQXZhdGFyUG9wdXAiLCJjaGFuZ2VBdmF0YXJGb3JtIiwiY2hhbmdlQXZhdGFySW5wdXQiLCJhZGROZXdDYXJkUG9wdXAiLCJhZGROZXdDYXJkQnV0dG9uIiwiYWRkTmV3Q2FyZEZvcm0iLCJjYXJkTmFtZUlucHV0IiwiY2FyZGxpbmtJbnB1dCIsInNob3dJbWFnZVBvcHVwIiwicG9wdXBJbWFnZSIsInBvcHVwSW1hZ2VDYXB0aW9uIiwicmVtb3ZlQ2FyZFBvcHVwIiwicmVtb3ZlQ2FyZEZvcm0iLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwicmVtb3ZlQ2FyZCIsInNob3dJbWFnZSIsImFsbCIsInJlc3VsdHMiLCJfcmVzdWx0cyIsIl9zbGljZWRUb0FycmF5IiwidXNlckRhdGEiLCJpbml0aWFsQ2FyZHMiLCJhYm91dCIsInNldEF0dHJpYnV0ZSIsImZvckVhY2giLCJjYXJkIiwiYXBwZW5kIiwiaXRlbSIsImN1cnJlbnRUYXJnZXQiLCJjbG9zZU1vZGFsT25CYWNrZHJvcENsaWNrIiwiQXJyYXkiLCJmcm9tIiwiY2hhbmdlVXNlckRhdGEiLCJjYXJkTmFtZSIsImNhcmRMaW5rIiwicHJlcGVuZCIsIl9jYXJkRGF0YUZvclJlbW92ZTIiLCJjdXJyZW50Q2FyZCIsInJlbW92ZUN1cnJlbnRDYXJkIiwiZ2V0IiwiaW5jbHVkZXMiLCJwYXR0ZXJuTWlzbWF0Y2giLCJzZXRDdXN0b21WYWxpZGl0eSIsImRhdGFzZXQiLCJlcnJvck1lc3NhZ2UiLCJzaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiaXNWYWxpZCIsInNldEV2ZW50TGlzdGVuZXJzIl0sInNvdXJjZVJvb3QiOiIifQ==
(()=>{"use strict";var e={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"25acbbe0-12c1-426d-be21-ec07addb3936","Content-Type":"application/json"}},t=function(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},n=function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},r=function(t){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(e,t,n,r,c){var a=document.querySelector("#card-template").content.cloneNode(!0);if(a.querySelector(".card__title").textContent=e.name,a.querySelector(".card__image").src=e.link,a.querySelector(".card__image").alt=e.name,e.likes.length){a.querySelector(".card__like-count").textContent=e.likes.length,a.querySelector(".card__like-count").classList.add("card__like-count_is-active");var i,u=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,c=function(){};return{s:c,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){u=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw a}}}}(e.likes);try{for(u.s();!(i=u.n()).done;)i.value._id===t&&a.querySelector(".card__like-button").classList.add("card__like-button_is-active")}catch(e){u.e(e)}finally{u.f()}}return e.owner._id!==t&&a.querySelector(".card__delete-button").classList.add("card__delete-button_hidden"),a.querySelector(".card__image").addEventListener("click",(function(){c(e)})),a.querySelector(".card__delete-button").addEventListener("click",(function(t){n(t,e)})),a.querySelector(".card__like-button").addEventListener("click",(function(t){r(t,e)})),a},a=function(t,n){var r,o=t.target,c=t.target.closest(".card__like-block").querySelector(".card__like-count");o.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n._id).then((function(e){o.classList.remove("card__like-button_is-active"),e.likes.length?c.textContent=e.likes.length:c.classList.remove("card__like-count_is-active")})):(r=n._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){o.classList.add("card__like-button_is-active"),c.classList.add("card__like-count_is-active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)}))},i=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)},u=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)},l=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");u(t)}},s=function(e,t,n){var r=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},d=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},f=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);d(n,r,t),n.forEach((function(n){s(e,n,t)}))};function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _,y=document.querySelector(".places__list"),v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),S=document.querySelectorAll(".popup"),k=document.querySelectorAll(".popup__close"),g=document.querySelector(".popup_type_edit"),q=document.querySelector(".profile__edit-button"),E=document.forms["edit-profile"],L=E.elements.name,C=E.elements.description,j=document.querySelector(".popup_type_change-avatar"),A=document.forms["new-avatar"],w=A.elements.link,x=document.querySelector(".popup_type_new-card"),P=document.querySelector(".profile__add-button"),U=document.forms["new-place"],T=U.elements["place-name"],O=U.elements.link,D=document.querySelector(".popup_type_delete-card"),B=document.querySelector(".popup_type_image"),I=document.querySelector(".popup__image"),M=document.querySelector(".popup__caption"),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},H=function(e,t){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"},J=function(t,n){var r=D.querySelector(".popup__button");i(D),r.addEventListener("click",(function(){var r;u(D),(r=n._id,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){t.target.closest(".card").remove()})).catch((function(e){console.log(e)}))}))},V=function(e){i(B),I.src=e.link,I.alt=e.name,M.textContent=e.name};t().then((function(e){v.textContent=e.name,h.textContent=e.about,b.setAttribute("style","background-image: url(".concat(e.avatar,");"))})).catch((function(e){console.log(e)})),Promise.all([t(),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t=p(e,2),n=t[0];t[1].forEach((function(e){var t,r,o;t=e,r=n._id,o=c(t,r,J,a,V),y.append(o)}))})).catch((function(e){console.log(e)})),k.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.closest(".popup");u(t)}))})),S.forEach((function(e){e.addEventListener("click",(function(t){!function(e,t){e.currentTarget===e.target&&u(t)}(t,e)}))})),q.addEventListener("click",(function(){L.value=v.textContent,C.value=h.textContent,f(E,N),i(g)})),E.addEventListener("submit",(function(t){t.preventDefault();var n={name:L.value,about:C.value};H(g,!0),function(t){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t.name,about:t.about})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(e){v.textContent=e.name,h.textContent=e.about,u(g)})).catch((function(e){console.log(e)})).finally((function(){H(g,!1)}))})),P.addEventListener("click",(function(){i(x)})),U.addEventListener("submit",(function(e){e.preventDefault();var n={name:T.value,link:O.value};H(x,!0),Promise.all([t(),r(n)]).then((function(e){var t=p(e,2),n=t[0],r=t[1],o=c(r,n._id,J,a,V);y.prepend(o),u(x),U.reset(),f(U,N)})).catch((function(e){console.log(e)})).finally((function(){H(x,!1)}))})),b.addEventListener("click",(function(){i(j)})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),H(j,!0),Promise.all([(t=w.value,fetch("".concat(t),{method:"HEAD"}).then((function(e){if(!e.headers.get("Content-Type").includes("image"))return Promise.reject("Ошибка: ".concat(e.status))}))),n(w.value)]).then((function(e){var t=e[1];b.setAttribute("style","background-image: url(".concat(t.avatar,");")),u(j),A.reset(),f(A,N)})).catch((function(e){console.log(e)})).finally((function(){H(j,!1)}))})),_=N,Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);d(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?s(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),d(n,r,t)}))}))}(e,_)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YUMsRUFBY0MsR0FDbkNJLEVBQWtCQyxFQUFXQyxFQUFlTixFQUM5QyxHQUNGLEdBQ0YsQ0FTSStFLENBQWtCakYsRUFBYUUsRUFDakMsRyIsInNvdXJjZXMiOlsid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy9hcGkuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL2NhcmQuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9zY3JpcHRzL21vZGFsLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QtZmYvLi9zcmMvc2NyaXB0cy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjb25maWcgPSB7XHJcbiAgYmFzZVVybDogJ2h0dHBzOi8vbWVzdG8ubm9tb3JlcGFydGllcy5jby92MS93ZmYtY29ob3J0LTInLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246ICcyNWFjYmJlMC0xMmMxLTQyNmQtYmUyMS1lYzA3YWRkYjM5MzYnLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGdldFVzZXJEYXRhID0gKCkgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVyc1xyXG4gIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNoYW5nZVVzZXJEYXRhID0gKHVzZXJEYXRhKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxyXG4gICAgICBhYm91dDogdXNlckRhdGEuYWJvdXRcclxuICAgIH0pXHJcbiAgfSlcclxuICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYNCe0YjQuNCx0LrQsDogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjaGFuZ2VVc2VyQXZhdGFyID0gKGxpbmtJbWFnZSkgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogbGlua0ltYWdlXHJcbiAgICB9KVxyXG4gIH0pXHJcbiAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LA6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY2hlY2tJbWFnZVVybCA9IChsaW5rSW1hZ2UpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7bGlua0ltYWdlfWAsIHtcclxuICAgIG1ldGhvZDogJ0hFQUQnLFxyXG4gIH0pXHJcbiAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAoIXJlcy5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykuaW5jbHVkZXMoJ2ltYWdlJykpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYNCe0YjQuNCx0LrQsDogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGdldEluaXRpYWxDYXJkcyA9ICgpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcclxuICB9KVxyXG4gICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHNlbmROZXdDYXJkID0gKGNhcmREYXRhKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIG5hbWU6IGNhcmREYXRhLm5hbWUsXHJcbiAgICAgIGxpbms6IGNhcmREYXRhLmxpbmtcclxuICAgIH0pXHJcbiAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LA6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVsZXRlQ3VycmVudENhcmQgPSAoY2FyZElkKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnNcclxuICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAoIXJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcHV0TGlrZSA9IChjYXJkSWQpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVyc1xyXG4gIH0pXHJcbiAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LA6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZGVsZXRlTGlrZSA9IChjYXJkSWQpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVyc1xyXG4gIH0pXHJcbiAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LA6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG59XHJcbiIsImltcG9ydCB7IHB1dExpa2UsIGRlbGV0ZUxpa2UgfSBmcm9tIFwiLi9hcGlcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBjcmVhdGVDYXJkID0gKGNhcmREYXRhLCB1c2VyRGF0YUlkLCDRgWFsbGJhY2tGb3JSZW1vdmUsINGBYWxsYmFja0Zvckxpa2UsINGBYWxsYmFja0ZvclNob3dJbWFnZSkgPT4ge1xyXG4gIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYXJkLXRlbXBsYXRlJykuY29udGVudDtcclxuICBjb25zdCBuZXdDYXJkID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcclxuXHJcbiAgbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fdGl0bGUnKS50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XHJcbiAgbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9faW1hZ2UnKS5zcmMgPSBjYXJkRGF0YS5saW5rO1xyXG4gIG5ld0NhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2ltYWdlJykuYWx0ID0gY2FyZERhdGEubmFtZTtcclxuXHJcbiAgaWYgKGNhcmREYXRhLmxpa2VzLmxlbmd0aCkge1xyXG4gICAgbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpLnRleHRDb250ZW50ID0gY2FyZERhdGEubGlrZXMubGVuZ3RoO1xyXG4gICAgbmV3Q2FyZC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtY291bnRfaXMtYWN0aXZlJyk7XHJcblxyXG4gICAgZm9yIChjb25zdCBvd25lckxpa2Ugb2YgY2FyZERhdGEubGlrZXMpIHtcclxuICAgICAgaWYgKG93bmVyTGlrZVsnX2lkJ10gPT09IHVzZXJEYXRhSWQpIHtcclxuICAgICAgICBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ1dHRvbicpLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpZiAoY2FyZERhdGEub3duZXJbJ19pZCddICE9PSB1c2VyRGF0YUlkKSB7XHJcbiAgICBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19kZWxldGUtYnV0dG9uJykuY2xhc3NMaXN0LmFkZCgnY2FyZF9fZGVsZXRlLWJ1dHRvbl9oaWRkZW4nKTtcclxuICB9XHJcblxyXG4gIG5ld0NhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2ltYWdlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICDRgWFsbGJhY2tGb3JTaG93SW1hZ2UoY2FyZERhdGEpO1xyXG4gIH0pO1xyXG4gIG5ld0NhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2RlbGV0ZS1idXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICAgINGBYWxsYmFja0ZvclJlbW92ZShldnQsIGNhcmREYXRhKTtcclxuICB9KTtcclxuICBuZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAg0YFhbGxiYWNrRm9yTGlrZShldnQsIGNhcmREYXRhKTtcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIG5ld0NhcmQ7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBsaWtlQ2FyZCA9IChldnQsIGNhcmREYXRhKSA9PiB7XHJcbiAgY29uc3QgbGlrZUJ1dHRvbiA9IGV2dC50YXJnZXQ7XHJcbiAgY29uc3QgbGlrZUNvdW50ID0gZXZ0LnRhcmdldC5jbG9zZXN0KCcuY2FyZF9fbGlrZS1ibG9jaycpLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50Jyk7XHJcblxyXG4gIGlmICghbGlrZUJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpKSB7XHJcbiAgICBwdXRMaWtlKGNhcmREYXRhWydfaWQnXSlcclxuICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgICAgICAgbGlrZUNvdW50LmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtY291bnRfaXMtYWN0aXZlJyk7XHJcbiAgICAgICAgbGlrZUNvdW50LnRleHRDb250ZW50ID0gcmVzdWx0Lmxpa2VzLmxlbmd0aDtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICB9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgZGVsZXRlTGlrZShjYXJkRGF0YVsnX2lkJ10pXHJcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIGlmIChyZXN1bHQubGlrZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICBsaWtlQ291bnQudGV4dENvbnRlbnQgPSByZXN1bHQubGlrZXMubGVuZ3RoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBsaWtlQ291bnQuY2xhc3NMaXN0LnJlbW92ZSgnY2FyZF9fbGlrZS1jb3VudF9pcy1hY3RpdmUnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgfVxyXG59IiwiY29uc3Qgb3Blbk1vZGFsID0gKHBvcHVwKSA9PiB7XHJcbiAgcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGNsb3NlTW9kYWxPbkVzY1ByZXNzKTtcclxufVxyXG5cclxuY29uc3QgY2xvc2VNb2RhbCA9IChwb3B1cCkgPT4ge1xyXG4gIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBjbG9zZU1vZGFsT25Fc2NQcmVzcyk7XHJcbn1cclxuXHJcbmNvbnN0IGNsb3NlTW9kYWxPbkVzY1ByZXNzID0gKGV2dCkgPT4ge1xyXG4gIGlmIChldnQua2V5ID09PSAnRXNjYXBlJykge1xyXG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgICBjbG9zZU1vZGFsKG9wZW5lZFBvcHVwKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGNsb3NlTW9kYWxPbkJhY2tkcm9wQ2xpY2sgPSAoZXZ0LCBwb3B1cCkgPT4ge1xyXG4gIGlmIChldnQuY3VycmVudFRhcmdldCA9PT0gZXZ0LnRhcmdldCkgY2xvc2VNb2RhbChwb3B1cCk7XHJcbn1cclxuXHJcbmV4cG9ydCB7IG9wZW5Nb2RhbCwgY2xvc2VNb2RhbCwgY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayB9IiwiY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBmb3JtRGF0YSkgPT4ge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5uYW1lfS1lcnJvcmApO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGZvcm1EYXRhLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGZvcm1EYXRhLmVycm9yQ2xhc3MpO1xyXG59O1xyXG5cclxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZm9ybURhdGEpID0+IHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQubmFtZX0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShmb3JtRGF0YS5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGZvcm1EYXRhLmVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9ICcnO1xyXG59O1xyXG5cclxuY29uc3QgaXNWYWxpZCA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGlmIChpbnB1dEVsZW1lbnQudmFsaWRpdHkucGF0dGVybk1pc21hdGNoKSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuc2V0Q3VzdG9tVmFsaWRpdHkoaW5wdXRFbGVtZW50LmRhdGFzZXQuZXJyb3JNZXNzYWdlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KFwiXCIpO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSwgZm9ybURhdGEpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICB9KVxyXG59O1xyXG5cclxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoZm9ybURhdGEuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShmb3JtRGF0YS5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgZm9ybURhdGEpID0+IHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuaW5wdXRTZWxlY3RvcikpO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGZvcm1EYXRhLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBmb3JtRGF0YSk7XHJcblxyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcclxuICAgICAgaXNWYWxpZChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGZvcm1EYXRhKSA9PiB7XHJcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybURhdGEuZm9ybVNlbGVjdG9yKSk7XHJcblxyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XHJcblx0XHRmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgZm9ybURhdGEpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3QgY2xlYXJWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBmb3JtRGF0YSkgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChmb3JtRGF0YS5pbnB1dFNlbGVjdG9yKSk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoZm9ybURhdGEuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIFxyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgZm9ybURhdGEpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBmb3JtRGF0YSk7XHJcbiAgfSlcclxufVxyXG5cclxuZXhwb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgY2xlYXJWYWxpZGF0aW9uIH0iLCJpbXBvcnQgJy4uL3BhZ2VzL2luZGV4LmNzcyc7XHJcblxyXG5pbXBvcnQgeyBjcmVhdGVDYXJkLCBsaWtlQ2FyZCB9IGZyb20gJy4vY2FyZC5qcyc7XHJcbmltcG9ydCB7IG9wZW5Nb2RhbCwgY2xvc2VNb2RhbCwgY2xvc2VNb2RhbE9uQmFja2Ryb3BDbGljayB9IGZyb20gJy4vbW9kYWwuanMnO1xyXG5pbXBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCBjbGVhclZhbGlkYXRpb24gfSBmcm9tICcuL3ZhbGlkYXRpb24uanMnO1xyXG5pbXBvcnQgeyBnZXRVc2VyRGF0YSwgY2hhbmdlVXNlckRhdGEsIGdldEluaXRpYWxDYXJkcywgc2VuZE5ld0NhcmQsIGRlbGV0ZUN1cnJlbnRDYXJkLCBjaGFuZ2VVc2VyQXZhdGFyLCBjaGVja0ltYWdlVXJsIH0gZnJvbSAnLi9hcGkuanMnO1xyXG5cclxuY29uc3QgY2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGFjZXNfX2xpc3QnKTtcclxuXHJcbmNvbnN0IHVzZXJOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3RpdGxlJyk7XHJcbmNvbnN0IHVzZXJEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19kZXNjcmlwdGlvbicpO1xyXG5jb25zdCB1c2VyQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2ltYWdlJyk7XHJcblxyXG5jb25zdCBwb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXAnKTtcclxuY29uc3QgYnV0dG9uc0Nsb3NlUG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwX19jbG9zZScpO1xyXG5cclxuY29uc3QgcHJvZmlsZUVkaXRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2VkaXQnKTtcclxuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fZWRpdC1idXR0b24nKTtcclxuY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gZG9jdW1lbnQuZm9ybXNbJ2VkaXQtcHJvZmlsZSddO1xyXG5jb25zdCBuYW1lSW5wdXQgPSBwcm9maWxlRWRpdEZvcm0uZWxlbWVudHMubmFtZTtcclxuY29uc3QgZGVzY3JpcHRpb25JbnB1dCA9IHByb2ZpbGVFZGl0Rm9ybS5lbGVtZW50cy5kZXNjcmlwdGlvbjtcclxuXHJcbmNvbnN0IGNoYW5nZUF2YXRhclBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfY2hhbmdlLWF2YXRhcicpO1xyXG5jb25zdCBjaGFuZ2VBdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbJ25ldy1hdmF0YXInXTtcclxuY29uc3QgY2hhbmdlQXZhdGFySW5wdXQgPSBjaGFuZ2VBdmF0YXJGb3JtLmVsZW1lbnRzLmxpbms7XHJcblxyXG5jb25zdCBhZGROZXdDYXJkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9uZXctY2FyZCcpO1xyXG5jb25zdCBhZGROZXdDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKTtcclxuY29uc3QgYWRkTmV3Q2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtc1snbmV3LXBsYWNlJ107XHJcbmNvbnN0IGNhcmROYW1lSW5wdXQgPSBhZGROZXdDYXJkRm9ybS5lbGVtZW50c1sncGxhY2UtbmFtZSddO1xyXG5jb25zdCBjYXJkbGlua0lucHV0ID0gYWRkTmV3Q2FyZEZvcm0uZWxlbWVudHMubGluaztcclxuXHJcbmNvbnN0IGRlbGV0ZUNhcmRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2RlbGV0ZS1jYXJkJyk7XHJcblxyXG5jb25zdCBzaG93SW1hZ2VQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2ltYWdlJyk7XHJcbmNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ltYWdlJylcclxuY29uc3QgcG9wdXBJbWFnZUNhcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2NhcHRpb24nKTtcclxuXHJcbmNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiAnLnBvcHVwX19mb3JtJyxcclxuICBpbnB1dFNlbGVjdG9yOiAnLnBvcHVwX19pbnB1dCcsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcucG9wdXBfX2J1dHRvbicsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogJ3BvcHVwX19idXR0b25fZGlzYWJsZWQnLFxyXG4gIGlucHV0RXJyb3JDbGFzczogJ3BvcHVwX19pbnB1dF90eXBlX2Vycm9yJyxcclxuICBlcnJvckNsYXNzOiAncG9wdXBfX2Vycm9yX3Zpc2libGUnXHJcbn1cclxuXHJcbmNvbnN0IHJlbmRlckNhcmQgPSAoY2FyZERhdGEsIHVzZXJEYXRhSWQsINGBYWxsYmFja0ZvclJlbW92ZSwg0YFhbGxiYWNrRm9yTGlrZSwg0YFhbGxiYWNrRm9yU2hvd0ltYWdlKSA9PiB7XHJcbiAgY29uc3QgbmV3Q2FyZCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEsIHVzZXJEYXRhSWQsINGBYWxsYmFja0ZvclJlbW92ZSwg0YFhbGxiYWNrRm9yTGlrZSwg0YFhbGxiYWNrRm9yU2hvd0ltYWdlKTtcclxuICBjYXJkQ29udGFpbmVyLmFwcGVuZChuZXdDYXJkKTtcclxufVxyXG5cclxuY29uc3QgcmVuZGVyTG9hZGluZyA9IChwb3B1cCwgaXNMb2FkaW5nKSA9PiB7XHJcbiAgY29uc3QgYnV0dG9uUG9wdXAgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xyXG4gIGlmIChpc0xvYWRpbmcpIHtcclxuICAgIGJ1dHRvblBvcHVwLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJztcclxuICB9IGVsc2Uge1xyXG4gICAgYnV0dG9uUG9wdXAudGV4dENvbnRlbnQgPSAn0KHQvtGF0YDQsNC90LjRgtGMJztcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGVkaXRQcm9maWxlID0gKGV2dCkgPT4ge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHVzZXJEYXRhID0ge1xyXG4gICAgbmFtZTogbmFtZUlucHV0LnZhbHVlLFxyXG4gICAgYWJvdXQ6IGRlc2NyaXB0aW9uSW5wdXQudmFsdWVcclxuICB9XHJcbiAgcmVuZGVyTG9hZGluZyhwcm9maWxlRWRpdFBvcHVwLCB0cnVlKTtcclxuICBjaGFuZ2VVc2VyRGF0YSh1c2VyRGF0YSlcclxuICAgIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgdXNlck5hbWUudGV4dENvbnRlbnQgPSByZXN1bHQubmFtZTtcclxuICAgICAgdXNlckRlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gcmVzdWx0LmFib3V0O1xyXG4gICAgICBjbG9zZU1vZGFsKHByb2ZpbGVFZGl0UG9wdXApO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKHByb2ZpbGVFZGl0UG9wdXAsIGZhbHNlKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jb25zdCBjaGFuZ2VBdmF0YXIgPSAoZXZ0KSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgcmVuZGVyTG9hZGluZyhjaGFuZ2VBdmF0YXJQb3B1cCwgdHJ1ZSk7XHJcbiAgUHJvbWlzZS5hbGwoW2NoZWNrSW1hZ2VVcmwoY2hhbmdlQXZhdGFySW5wdXQudmFsdWUpLCBjaGFuZ2VVc2VyQXZhdGFyKGNoYW5nZUF2YXRhcklucHV0LnZhbHVlKV0pXHJcbiAgICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgICBjb25zdCB1c2VyRGF0YSA9IHJlc3VsdHNbMV07XHJcbiAgICAgIHVzZXJBdmF0YXIuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt1c2VyRGF0YS5hdmF0YXJ9KTtgKTtcclxuICAgICAgY2xvc2VNb2RhbChjaGFuZ2VBdmF0YXJQb3B1cCk7XHJcbiAgICAgIGNoYW5nZUF2YXRhckZvcm0ucmVzZXQoKTtcclxuICAgICAgY2xlYXJWYWxpZGF0aW9uKGNoYW5nZUF2YXRhckZvcm0sIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKGNoYW5nZUF2YXRhclBvcHVwLCBmYWxzZSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuY29uc3QgYWRkTmV3Q2FyZCA9IChldnQpID0+IHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBjYXJkRGF0YSA9IHtcclxuICAgIG5hbWU6IGNhcmROYW1lSW5wdXQudmFsdWUsXHJcbiAgICBsaW5rOiBjYXJkbGlua0lucHV0LnZhbHVlXHJcbiAgfTtcclxuICByZW5kZXJMb2FkaW5nKGFkZE5ld0NhcmRQb3B1cCwgdHJ1ZSk7XHJcbiAgUHJvbWlzZS5hbGwoW2dldFVzZXJEYXRhKCksIHNlbmROZXdDYXJkKGNhcmREYXRhKV0pXHJcbiAgICAudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgIGNvbnN0IFt1c2VyRGF0YSwgY2FyZF0gPSByZXN1bHQ7XHJcbiAgICAgIGNvbnN0IG5ld0NhcmQgPSBjcmVhdGVDYXJkKGNhcmQsIHVzZXJEYXRhWydfaWQnXSwgcmVtb3ZlQ2FyZCwgbGlrZUNhcmQsIHNob3dJbWFnZSk7XHJcbiAgICAgIGNhcmRDb250YWluZXIucHJlcGVuZChuZXdDYXJkKTtcclxuICAgICAgY2xvc2VNb2RhbChhZGROZXdDYXJkUG9wdXApO1xyXG4gICAgICBhZGROZXdDYXJkRm9ybS5yZXNldCgpO1xyXG4gICAgICBjbGVhclZhbGlkYXRpb24oYWRkTmV3Q2FyZEZvcm0sIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICByZW5kZXJMb2FkaW5nKGFkZE5ld0NhcmRQb3B1cCwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmNvbnN0IHJlbW92ZUNhcmQgPSAoZXZ0LCBjYXJkRGF0YSkgPT4ge1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBkZWxldGVDYXJkUG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcclxuICBvcGVuTW9kYWwoZGVsZXRlQ2FyZFBvcHVwKTtcclxuICBidXR0b25FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgY2xvc2VNb2RhbChkZWxldGVDYXJkUG9wdXApO1xyXG4gICAgZGVsZXRlQ3VycmVudENhcmQoY2FyZERhdGFbJ19pZCddKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgZXZ0LnRhcmdldC5jbG9zZXN0KCcuY2FyZCcpLnJlbW92ZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5jb25zdCBzaG93SW1hZ2UgPSAoY2FyZERhdGEpID0+IHtcclxuICBvcGVuTW9kYWwoc2hvd0ltYWdlUG9wdXApO1xyXG4gIHBvcHVwSW1hZ2Uuc3JjID0gY2FyZERhdGEubGluaztcclxuICBwb3B1cEltYWdlLmFsdCA9IGNhcmREYXRhLm5hbWU7XHJcbiAgcG9wdXBJbWFnZUNhcHRpb24udGV4dENvbnRlbnQgPSBjYXJkRGF0YS5uYW1lO1xyXG59XHJcblxyXG5nZXRVc2VyRGF0YSgpXHJcbiAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XHJcbiAgICB1c2VyTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XHJcbiAgICB1c2VyRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICAgIHVzZXJBdmF0YXIuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt1c2VyRGF0YS5hdmF0YXJ9KTtgKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pO1xyXG5cclxuUHJvbWlzZS5hbGwoW2dldFVzZXJEYXRhKCksIGdldEluaXRpYWxDYXJkcygpXSlcclxuICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgY29uc3QgW3VzZXJEYXRhLCBpbml0aWFsQ2FyZHNdID0gcmVzdWx0cztcclxuICAgIGluaXRpYWxDYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgIHJlbmRlckNhcmQoY2FyZCwgdXNlckRhdGFbJ19pZCddLCByZW1vdmVDYXJkLCBsaWtlQ2FyZCwgc2hvd0ltYWdlKTtcclxuICAgIH0pO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgfSk7XHJcblxyXG5idXR0b25zQ2xvc2VQb3B1cHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XHJcbiAgICBjb25zdCBvcGVuZWRQb3B1cCA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLnBvcHVwJyk7XHJcbiAgICBjbG9zZU1vZGFsKG9wZW5lZFBvcHVwKTtcclxuICB9KTtcclxufSk7XHJcblxyXG5wb3B1cHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KSA9PiB7XHJcbiAgICBjbG9zZU1vZGFsT25CYWNrZHJvcENsaWNrKGV2dCwgaXRlbSk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgbmFtZUlucHV0LnZhbHVlID0gdXNlck5hbWUudGV4dENvbnRlbnQ7XHJcbiAgZGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHVzZXJEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcclxuICBjbGVhclZhbGlkYXRpb24ocHJvZmlsZUVkaXRGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICBvcGVuTW9kYWwocHJvZmlsZUVkaXRQb3B1cCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUVkaXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGVkaXRQcm9maWxlKTtcclxuXHJcbmFkZE5ld0NhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgb3Blbk1vZGFsKGFkZE5ld0NhcmRQb3B1cCk7XHJcbn0pO1xyXG5cclxuYWRkTmV3Q2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYWRkTmV3Q2FyZCk7XHJcblxyXG51c2VyQXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG9wZW5Nb2RhbChjaGFuZ2VBdmF0YXJQb3B1cCk7XHJcbn0pXHJcblxyXG5jaGFuZ2VBdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGNoYW5nZUF2YXRhcik7XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpOyJdLCJuYW1lcyI6WyJjb25maWciLCJiYXNlVXJsIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJnZXRVc2VyRGF0YSIsImZldGNoIiwiY29uY2F0IiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJjaGFuZ2VVc2VyQXZhdGFyIiwibGlua0ltYWdlIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhdmF0YXIiLCJzZW5kTmV3Q2FyZCIsImNhcmREYXRhIiwibmFtZSIsImxpbmsiLCJjcmVhdGVDYXJkIiwidXNlckRhdGFJZCIsItGBYWxsYmFja0ZvclJlbW92ZSIsItGBYWxsYmFja0Zvckxpa2UiLCLRgWFsbGJhY2tGb3JTaG93SW1hZ2UiLCJuZXdDYXJkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsInRleHRDb250ZW50Iiwic3JjIiwiYWx0IiwibGlrZXMiLCJsZW5ndGgiLCJjbGFzc0xpc3QiLCJhZGQiLCJfc3RlcCIsIl9pdGVyYXRvciIsIl9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIiwicyIsIm4iLCJkb25lIiwidmFsdWUiLCJlcnIiLCJlIiwiZiIsIm93bmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsImxpa2VDYXJkIiwiY2FyZElkIiwibGlrZUJ1dHRvbiIsInRhcmdldCIsImxpa2VDb3VudCIsImNsb3Nlc3QiLCJjb250YWlucyIsImRlbGV0ZUxpa2UiLCJyZXN1bHQiLCJyZW1vdmUiLCJjYXRjaCIsImNvbnNvbGUiLCJsb2ciLCJvcGVuTW9kYWwiLCJwb3B1cCIsImNsb3NlTW9kYWxPbkVzY1ByZXNzIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJvcGVuZWRQb3B1cCIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJmb3JtRGF0YSIsImVycm9yRWxlbWVudCIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImNsZWFyVmFsaWRhdGlvbiIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJmb3JFYWNoIiwiY2FyZENvbnRhaW5lciIsInVzZXJOYW1lIiwidXNlckRlc2NyaXB0aW9uIiwidXNlckF2YXRhciIsInBvcHVwcyIsImJ1dHRvbnNDbG9zZVBvcHVwcyIsInByb2ZpbGVFZGl0UG9wdXAiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVFZGl0Rm9ybSIsImZvcm1zIiwibmFtZUlucHV0IiwiZWxlbWVudHMiLCJkZXNjcmlwdGlvbklucHV0IiwiZGVzY3JpcHRpb24iLCJjaGFuZ2VBdmF0YXJQb3B1cCIsImNoYW5nZUF2YXRhckZvcm0iLCJjaGFuZ2VBdmF0YXJJbnB1dCIsImFkZE5ld0NhcmRQb3B1cCIsImFkZE5ld0NhcmRCdXR0b24iLCJhZGROZXdDYXJkRm9ybSIsImNhcmROYW1lSW5wdXQiLCJjYXJkbGlua0lucHV0IiwiZGVsZXRlQ2FyZFBvcHVwIiwic2hvd0ltYWdlUG9wdXAiLCJwb3B1cEltYWdlIiwicG9wdXBJbWFnZUNhcHRpb24iLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsInJlbW92ZUNhcmQiLCJzaG93SW1hZ2UiLCJ1c2VyRGF0YSIsImFib3V0Iiwic2V0QXR0cmlidXRlIiwiYWxsIiwicmVzdWx0cyIsIl9yZXN1bHRzIiwiX3NsaWNlZFRvQXJyYXkiLCJjYXJkIiwiYXBwZW5kIiwiaXRlbSIsImN1cnJlbnRUYXJnZXQiLCJjbG9zZU1vZGFsT25CYWNrZHJvcENsaWNrIiwicHJldmVudERlZmF1bHQiLCJjaGFuZ2VVc2VyRGF0YSIsImZpbmFsbHkiLCJfcmVzdWx0IiwicHJlcGVuZCIsInJlc2V0IiwiZ2V0IiwiaW5jbHVkZXMiLCJwYXR0ZXJuTWlzbWF0Y2giLCJzZXRDdXN0b21WYWxpZGl0eSIsImRhdGFzZXQiLCJlcnJvck1lc3NhZ2UiLCJzaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiaXNWYWxpZCIsInNldEV2ZW50TGlzdGVuZXJzIl0sInNvdXJjZVJvb3QiOiIifQ==